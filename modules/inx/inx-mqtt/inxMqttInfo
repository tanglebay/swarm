#!/bin/bash
if [ -f "/usr/bin/inx-mqtt" ]; then

    source $swarmConfigs/inx-mqtt.cfg
    source $swarmConfigs/latest-versions.cfg

    inxMqttStatus=$(systemctl show -p ActiveState --value inx-mqtt)

    inxMqttVersion=$(/usr/bin/inx-mqtt -v | awk '{ print $2 }')
    if [ -z "$inxMqttVersion" ]; then
        inxMqttVersion="N/A"
    else
        if [ "$inxMqttVersion" != "$latestInxMqttVersion" ] && [ ! -z "$latestInxMqttVersion" ]; then
            inxMqttVersion="$inxMqttVersion (new version \"v$latestInxMqttVersion\" available!)"
        fi
    fi

    if [ "$inxMqttUpdateCheck" = "true" ]; then
        inxMqttUpdateCheckStatus="enabled"
    else
        inxMqttUpdateCheckStatus="disabled"
    fi

    if [ "$inxMqttWebsocketEnabled" = "true" ]; then
        inxMqttWebsocketEnabledStatus="enabled"
    else
        inxMqttWebsocketEnabledStatus="disabled"
    fi

    if [ "$inxMqttTcpEnabled" = "true" ]; then
        inxMqttTcpEnabledStatus="enabled"
    else
        inxMqttTcpEnabledStatus="disabled"
    fi

    # OUTPUT
    whiptail --title "INX-Mqtt - Info" --msgbox "INX-Mqtt: $inxMqttStatus\nVersion: v$inxMqttVersion\nUpdate Check: $inxMqttUpdateCheckStatus\nWebsocket: $inxMqttWebsocketEnabledStatus\nTCP: $inxMqttTcpEnabledStatus\n\nEnabled Plugins: \"$inxMqttEnablePlugins\"\nDisabled Plugins: \"$inxMqttDisablePlugins\"" 24 65
else
    # OUTPUT
    whiptail --title "INX-Mqtt - Info" --msgbox "INX-Mqtt not installed!" 8 65
fi
