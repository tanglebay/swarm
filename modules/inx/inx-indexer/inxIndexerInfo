#!/bin/bash
if [ -f "/usr/bin/inx-indexer" ]; then

    source $swarmConfigs/inx-indexer.cfg
    source $swarmConfigs/latest-versions.cfg

    inxIndexerStatus=$(systemctl show -p ActiveState --value inx-indexer)

    inxIndexerVersion=$(/usr/bin/inx-indexer -v | awk '{ print $2 }')
    if [ -z "$inxIndexerVersion" ]; then
        inxIndexerVersion="N/A"
    else
        if [ "$inxIndexerVersion" != "$latestInxIndexerVersion" ] && [ ! -z "$latestInxIndexerVersion" ]; then
            inxIndexerVersion="$inxIndexerVersion (new version \"v$latestInxIndexerVersion\" available!)"
        fi
    fi

    # DB size
    if [ -d "$inxIndexerHome/$inxIndexerNetwork/database" ]; then
        getCurrentDbSize="$(du -sb $inxIndexerHome/$inxIndexerNetwork/database | cut -f1)"
        let getCurrentDbSizeInMb=$getCurrentDbSize/1000000
        if [ $getCurrentDbSizeInMb -gt 999 ]; then
            let getCurrentDbSizeInGb=$getCurrentDbSize/1000000000
            currentInxIndexerDbSize="${getCurrentDbSizeInGb} GB"
        else
            currentInxIndexerDbSize="${getCurrentDbSizeInMb} MB"
        fi
    else
        currentInxIndexerDbSize="N/A"
    fi

    if [ "$inxIndexerUpdateCheck" = "true" ]; then
        inxIndexerUpdateCheckStatus="enabled"
    else
        inxIndexerUpdateCheckStatus="disabled"
    fi

    # OUTPUT
    whiptail --title "INX-Indexer - Info" --msgbox "INX-Indexer: $inxIndexerStatus\nVersion: v$inxIndexerVersion\nUpdate Check: $inxIndexerUpdateCheckStatus\nDB size: $currentInxIndexerDbSize\n\nEnabled Plugins: \"$inxIndexerEnablePlugins\"\nDisabled Plugins: \"$inxIndexerDisablePlugins\"" 24 65
else
    # OUTPUT
    whiptail --title "INX-Indexer - Info" --msgbox "INX-Indexer not installed!" 8 65
fi
