#!/bin/bash
if [ -f "/usr/bin/shimmer-inx-mqtt" ]; then

    source $swarmConfigs/shimmer-inx-mqtt.cfg
    source $swarmConfigs/latest-versions.cfg

    shimmerInxMqttStatus=$(systemctl show -p ActiveState --value shimmer-inx-mqtt)

    shimmerInxMqttVersionInfo=$(/usr/bin/shimmer-inx-mqtt -v | awk '{ print $2 }')
    if [ -z "$shimmerInxMqttVersionInfo" ]; then
        shimmerInxMqttVersionInfo="N/A"
    else
        if [ "$shimmerInxMqttVersionInfo" != "$latestShimmerInxMqttVersion" ] && [ ! -z "$latestShimmerInxMqttVersion" ]; then
            shimmerInxMqttVersionInfo="$shimmerInxMqttVersionInfo (new version \"v$latestShimmerInxMqttVersion\" available!)"
        fi
    fi

    if [ "$shimmerInxMqttUpdateCheck" = "true" ]; then
        shimmerInxMqttUpdateCheckStatus="enabled"
    else
        shimmerInxMqttUpdateCheckStatus="disabled"
    fi

    if [ "$shimmerInxMqttWebsocketEnabled" = "true" ]; then
        shimmerInxMqttWebsocketEnabledStatus="enabled"
    else
        shimmerInxMqttWebsocketEnabledStatus="disabled"
    fi

    if [ "$shimmerInxMqttTcpEnabled" = "true" ]; then
        shimmerInxMqttTcpEnabledStatus="enabled"
    else
        shimmerInxMqttTcpEnabledStatus="disabled"
    fi

    # OUTPUT
    whiptail --title "INX-Mqtt (Shimmer) - Info" --msgbox "INX-Mqtt: $shimmerInxMqttStatus\nVersion: v$shimmerInxMqttVersionInfo\nUpdate Check: $shimmerInxMqttUpdateCheckStatus\nWebsocket: $shimmerInxMqttWebsocketEnabledStatus\nTCP: $shimmerInxMqttTcpEnabledStatus\n\nEnabled Plugins: \"$shimmerInxMqttEnablePlugins\"\nDisabled Plugins: \"$shimmerInxMqttDisablePlugins\"" 24 65
else
    # OUTPUT
    whiptail --title "INX-Mqtt (Shimmer) - Info" --msgbox "INX-Mqtt not installed!" 8 65
fi
