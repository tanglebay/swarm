#!/bin/bash

useInxIndexerEnablePlugins=true
source $shimmerInxIndexerModules/shimmerInxIndexerPlugins

IFS=', ' read -r -a ARRAYshimmerInxIndexerEnablePlugins <<< "$shimmerInxIndexerEnablePlugins"

parser="$(jq '.app.enablePlugins' $shimmerInxIndexerHome/$shimmerInxIndexerConfig.json)"
parser="$(echo $parser | tr -d '[]" ')"
if [ "$parser" != "$shimmerInxIndexerEnablePlugins" ]; then
    sudo jq '.app.enablePlugins |= []' $shimmerInxIndexerHome/$shimmerInxIndexerConfig.json|sponge $shimmerInxIndexerHome/$shimmerInxIndexerConfig.json
    for shimmerInxIndexerEnablePlugin in "${ARRAYshimmerInxIndexerEnablePlugins[@]}"
    do
        if [ ! -z "$shimmerInxIndexerEnablePlugin" ]; then
            sudo jq '.app.enablePlugins |= .+ ["'$shimmerInxIndexerEnablePlugin'"]' $shimmerInxIndexerHome/$shimmerInxIndexerConfig.json|sponge $shimmerInxIndexerHome/$shimmerInxIndexerConfig.json
        fi
    done
    restartShimmerInxIndexer=true
    echo "shimmerInxIndexerEnablePlugins" >> /tmp/shimmerInxIndexerParsing
fi

unset ARRAYshimmerInxIndexerEnablePlugins shimmerInxIndexerEnablePlugin useShimmerInxIndexerEnablePlugins
