#!/bin/bash

useInxDashboardEnablePlugins=true
source $inxDashboardModules/inxDashboardPlugins

IFS=', ' read -r -a ARRAYinxDashboardEnablePlugins <<< "$inxDashboardEnablePlugins"

parser="$(jq '.app.enablePlugins' $inxDashboardHome/$inxDashboardConfig.json)"
parser="$(echo $parser | tr -d '[]" ')"
if [ "$parser" != "$inxDashboardEnablePlugins" ]; then
    sudo jq '.app.enablePlugins |= []' $inxDashboardHome/$inxDashboardConfig.json|sponge $inxDashboardHome/$inxDashboardConfig.json
    for inxDashboardEnablePlugin in "${ARRAYinxDashboardEnablePlugins[@]}"
    do
        if [ ! -z "$inxDashboardEnablePlugin" ]; then
            sudo jq '.app.enablePlugins |= .+ ["'$inxDashboardEnablePlugin'"]' $inxDashboardHome/$inxDashboardConfig.json|sponge $inxDashboardHome/$inxDashboardConfig.json
        fi
    done
    restartInxDashboard=true
    echo "inxDashboardEnablePlugins" >> /tmp/inxDashboardParsing
fi

unset ARRAYinxDashboardEnablePlugins inxDashboardEnablePlugin useInxDashboardEnablePlugins
