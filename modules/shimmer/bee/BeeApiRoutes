#!/bin/bash

# Unset VARS
unset shimmerBeeApiPublicRoutes

# /health
if [[ $shimmerBeeApiRoutes = */health* ]]; then
    shimmerBeeApiRoutesHealth=ON
else
    shimmerBeeApiRoutesHealth=OFF
    shimmerBeeApiPublicRoutes="/health"
fi

# /api/v2/info
if [[ $shimmerBeeApiRoutes = */api/v2/info* ]]; then
    shimmerBeeApiRoutesInfo=ON
else
    shimmerBeeApiRoutesInfo=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/info")
fi

# /api/v2/tips
if [[ $shimmerBeeApiRoutes = */api/v2/tips* ]]; then
    shimmerBeeApiRoutesTips=ON
else
    shimmerBeeApiRoutesTips=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/tips")
fi

# /api/v2/messages
if [[ $shimmerBeeApiRoutes = */api/v2/messages\** ]]; then
    shimmerBeeApiRoutesMessages=ON
else
    shimmerBeeApiRoutesMessages=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/messages,/api/v2/messages/:messageId,/api/v2/messages/:messageId/metadata,/api/v2/messages/:messageId/raw,/api/v2/messages/:messageId/children")
fi

#/api/v2/transactions
if [[ $shimmerBeeApiRoutes = */api/v2/transactions\** ]]; then
    shimmerBeeApiRoutesTransactions=ON
else
    shimmerBeeApiRoutesTransactions=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/transactions/:transactionId/included-message")
fi

#/api/v2/milestones
if [[ $shimmerBeeApiRoutes = */api/v2/milestones\** ]]; then
    shimmerBeeApiRoutesMilestones=ON
else
    shimmerBeeApiRoutesMilestones=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/milestones/:milestoneIndex,/api/v2/milestones/:milestoneIndex/utxo-changes")
fi

#/api/v2/outputs
if [[ $shimmerBeeApiRoutes = */api/v2/outputs\** ]]; then
    shimmerBeeApiRoutesOutputs=ON
else
    shimmerBeeApiRoutesOutputs=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/outputs/:outputId")
fi

#/api/v2/addresses
if [[ $shimmerBeeApiRoutes = */api/v2/addresses\** ]]; then
    shimmerBeeApiRoutesAddresses=ON
else
    shimmerBeeApiRoutesAddresses=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/addresses/:address,/api/v2/addresses/ed25519/:address,/api/v2/addresses/:address/outputs,/api/v2/addresses/ed25519/:address/outputs")
fi

#/api/v2/treasury
if [[ $shimmerBeeApiRoutes = */api/v2/treasury* ]]; then
    shimmerBeeApiRoutesTreasury=ON
else
    shimmerBeeApiRoutesTreasury=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/treasury")
fi

#/api/v2/receipts
if [[ $shimmerBeeApiRoutes = */api/v2/receipts\** ]]; then
    shimmerBeeApiRoutesReceipts=ON
else
    shimmerBeeApiRoutesReceipts=OFF
    shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes,/api/v2/receipts,/api/v2/receipts/:milestoneIndex")
fi

######

shimmerBeeApiPublicRoutes=$(echo "$shimmerBeeApiPublicRoutes" | tr -s ',,' ',')
validateShimmerBeeApiPublicRoutes=$(echo "${shimmerBeeApiPublicRoutes: -1}")
if [ "$validateShimmerBeeApiPublicRoutes" = "," ]; then
    shimmerBeeApiPublicRoutes="${shimmerBeeApiPublicRoutes%?}"
fi

if [ "$shimmerBeeUpdateApiRoutes" = "true" ]; then
    sudo sed -i 's~^shimmerBeeApiPublicRoutes=.*~shimmerBeeApiPublicRoutes="'$shimmerBeeApiPublicRoutes'"~' $swarmConfigs/shimmer-bee.cfg
fi
