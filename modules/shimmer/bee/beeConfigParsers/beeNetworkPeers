#!/bin/bash

if [ ! -z "$shimmerBeePeer1" ]; then
    parserShimmerBeeId1="$(jq '.network.peering.peers [0]' $shimmerBeeHome/$shimmerBeeConfig.json)"
    shimmerBeePeerId1="{ \"address\": \"'$shimmerBeePeer1'\", \"alias\": \"'$shimmerBeePeerAlias1'\" }"
fi
if [ ! -z "$shimmerBeePeer2" ]; then
    parserShimmerBeeId2="$(jq '.network.peering.peers [1]' $shimmerBeeHome/$shimmerBeeConfig.json)"
    shimmerBeePeerId2="{ \"address\": \"'$shimmerBeePeer2'\", \"alias\": \"'$shimmerBeePeerAlias2'\" }"
fi
if [ ! -z "$shimmerBeePeer3" ]; then
    parserShimmerBeeId3="$(jq '.network.peering.peers [2]' $shimmerBeeHome/$shimmerBeeConfig.json)"
    shimmerBeePeerId3="{ \"address\": \"'$shimmerBeePeer3'\", \"alias\": \"'$shimmerBeePeerAlias3'\" }"
fi
if [ ! -z "$shimmerBeePeer4" ]; then
    parserShimmerBeeId4="$(jq '.network.peering.peers [3]' $shimmerBeeHome/$shimmerBeeConfig.json)"
    shimmerBeePeerId1="{ \"address\": \"'$shimmerBeePeer4'\", \"alias\": \"'$shimmerBeePeerAlias4'\" }"
fi
if [ ! -z "$shimmerBeePeer5" ]; then
    parserShimmerBeeId5="$(jq '.network.peering.peers [4]' $shimmerBeeHome/$shimmerBeeConfig.json)"
    shimmerBeePeerId1="{ \"address\": \"'$shimmerBeePeer5'\", \"alias\": \"'$shimmerBeePeerAlias5'\" }"
fi
if [ ! -z "$shimmerBeePeer6" ]; then
    parserShimmerBeeId6="$(jq '.network.peering.peers [5]' $shimmerBeeHome/$shimmerBeeConfig.json)"
    shimmerBeePeerId1="{ \"address\": \"'$shimmerBeePeer6'\", \"alias\": \"'$shimmerBeePeerAlias6'\" }"
fi

# EMPTY ARRAY
sudo jq '.network.peering.peers = []' $shimmerBeeHome/$shimmerBeeConfig.json|sponge $shimmerBeeHome/$shimmerBeeConfig.json

# SET NEW PEERS
if [ "$parserShimmerBeeId1" != "$shimmerBeePeerId1" ] && [ ! -z "$shimmerBeePeer1" ]; then
    sudo jq '.network.peering.peers [0] |= . + { "address": "'$shimmerBeePeer1'", "alias": "'$shimmerBeePeerAlias1'" }' $shimmerBeeHome/$shimmerBeeConfig.json|sponge $shimmerBeeHome/$shimmerBeeConfig.json
    restartShimmerBee=true
fi
if [ "$parserShimmerBeeId2" != "$shimmerBeePeerId2" ] && [ ! -z "$shimmerBeePeer2" ]; then
    sudo jq '.network.peering.peers [1] |= . + { "address": "'$shimmerBeePeer2'", "alias": "'$shimmerBeePeerAlias2'" }' $shimmerBeeHome/$shimmerBeeConfig.json|sponge $shimmerBeeHome/$shimmerBeeConfig.json
    restartShimmerBee=true
fi
if [ "$parserShimmerBeeId3" != "$shimmerBeePeerId3" ] && [ ! -z "$shimmerBeePeer3" ]; then
    sudo jq '.network.peering.peers [2] |= . + { "address": "'$shimmerBeePeer3'", "alias": "'$shimmerBeePeerAlias3'" }' $shimmerBeeHome/$shimmerBeeConfig.json|sponge $shimmerBeeHome/$shimmerBeeConfig.json
    restartShimmerBee=true
fi
if [ "$parserShimmerBeeId4" != "$shimmerBeePeerId4" ] && [ ! -z "$shimmerBeePeer4" ]; then
    sudo jq '.network.peering.peers [3] |= . + { "address": "'$shimmerBeePeer4'", "alias": "'$shimmerBeePeerAlias4'" }' $shimmerBeeHome/$shimmerBeeConfig.json|sponge $shimmerBeeHome/$shimmerBeeConfig.json
    restartShimmerBee=true
fi
if [ "$parserShimmerBeeId5" != "$shimmerBeePeerId5" ] && [ ! -z "$shimmerBeePeer5" ]; then
    sudo jq '.network.peering.peers [4] |= . + { "address": "'$shimmerBeePeer5'", "alias": "'$shimmerBeePeerAlias5'" }' $shimmerBeeHome/$shimmerBeeConfig.json|sponge $shimmerBeeHome/$shimmerBeeConfig.json
    restartShimmerBee=true
fi
if [ "$parserShimmerBeeId6" != "$shimmerBeePeerId6" ] && [ ! -z "$shimmerBeePeer6" ]; then
    sudo jq '.network.peering.peers [5] |= . + { "address": "'$shimmerBeePeer6'", "alias": "'$shimmerBeePeerAlias6'" }' $shimmerBeeHome/$shimmerBeeConfig.json|sponge $shimmerBeeHome/$shimmerBeeConfig.json
    restartShimmerBee=true
fi
# DELETE NULL
sudo sed -i '/null,/d' $shimmerBeeHome/$shimmerBeeConfig.json
sudo sed -i '/null/d' $shimmerBeeHome/$shimmerBeeConfig.json
# UNSET VARS
unset parserShimmerBeeId1 parserShimmerBeeId2 parserShimmerBeeId3 parserShimmerBeeId4 parserShimmerBeeId5 parserShimmerBeeId6 shimmerBeePeerId1 shimmerBeePeerId2 shimmerBeePeerId3 shimmerBeePeerId4 shimmerBeePeerId5 shimmerBeePeerId6
