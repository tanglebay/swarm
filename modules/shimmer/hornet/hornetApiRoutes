#!/bin/bash

# Unset VARS
unset hornetShimmerApiPublicRoutes

# /health
if [[ $hornetShimmerApiRoutes = */health* ]]; then
    hornetShimmerApiRoutesHealth=ON
else
    hornetShimmerApiRoutesHealth=OFF
    hornetShimmerApiPublicRoutes="/health"
fi

# /api/v2/info
if [[ $hornetShimmerApiRoutes = */api/v2/info* ]]; then
    hornetShimmerApiRoutesInfo=ON
else
    hornetShimmerApiRoutesInfo=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/info")
fi

# /api/v2/tips
if [[ $hornetShimmerApiRoutes = */api/v2/tips* ]]; then
    hornetShimmerApiRoutesTips=ON
else
    hornetShimmerApiRoutesTips=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/tips")
fi

# /api/v2/blocks
if [[ $hornetShimmerApiRoutes = */api/v2/blocks\** ]]; then
    hornetShimmerApiRoutesBlocks=ON
else
    hornetShimmerApiRoutesBlocks=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/blocks*")
fi

#/api/v2/transactions
if [[ $hornetShimmerApiRoutes = */api/v2/transactions\** ]]; then
    hornetShimmerApiRoutesTransactions=ON
else
    hornetShimmerApiRoutesTransactions=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/transactions*")
fi

#/api/v2/milestones
if [[ $hornetShimmerApiRoutes = */api/v2/milestones\** ]]; then
    hornetShimmerApiRoutesMilestones=ON
else
    hornetShimmerApiRoutesMilestones=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/milestones*")
fi

#/api/v2/outputs
if [[ $hornetShimmerApiRoutes = */api/v2/outputs\** ]]; then
    hornetShimmerApiRoutesOutputs=ON
else
    hornetShimmerApiRoutesOutputs=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/outputs*")
fi

#/api/v2/addresses
if [[ $hornetShimmerApiRoutes = */api/v2/addresses\** ]]; then
    hornetShimmerApiRoutesAddresses=ON
else
    hornetShimmerApiRoutesAddresses=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/addresses*")
fi

#/api/v2/treasury
if [[ $hornetShimmerApiRoutes = */api/v2/treasury* ]]; then
    hornetShimmerApiRoutesTreasury=ON
else
    hornetShimmerApiRoutesTreasury=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/treasury")
fi

#/api/v2/receipts
if [[ $hornetShimmerApiRoutes = */api/v2/receipts\** ]]; then
    hornetShimmerApiRoutesReceipts=ON
else
    hornetShimmerApiRoutesReceipts=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/v2/receipts*")
fi

#/api/plugins/debug/v1/*
if [[ $hornetShimmerApiRoutes = */api/plugins/debug/v1/\** ]]; then
    hornetShimmerApiRoutesDebug=ON
else
    hornetShimmerApiRoutesDebug=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/plugins/debug/v1/*")
fi

#/api/plugins/indexer/v1/*
if [[ $hornetShimmerApiRoutes = */api/plugins/indexer/v1/\** ]]; then
    hornetShimmerApiRoutesIndexer=ON
else
    hornetShimmerApiRoutesIndexer=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/plugins/indexer/v1/*")
fi

# /api/plugins/mqtt/v1
if [[ $hornetShimmerApiRoutes = */api/plugins/mqtt/v1* ]]; then
    hornetShimmerApiRoutesMqtt=ON
else
    hornetShimmerApiRoutesMqtt=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/plugins/mqtt/v1")
fi

#/api/plugins/participation/v2/events*
if [[ $hornetShimmerApiRoutes = */api/plugins/participation/v2/events\** ]]; then
    hornetShimmerApiRoutesParticipationEvents=ON
else
    hornetShimmerApiRoutesParticipationEvents=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/plugins/participation/v2/events*")
fi

#/api/plugins/participation/v2/outputs*
if [[ $hornetShimmerApiRoutes = */api/plugins/participation/v2/outputs\** ]]; then
    hornetShimmerApiRoutesParticipationOutputs=ON
else
    hornetShimmerApiRoutesParticipationOutputs=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/plugins/participation/v2/outputs*")
fi

#/api/plugins/participation/v2/addresses*
if [[ $hornetShimmerApiRoutes = */api/plugins/participation/v2/addresses\** ]]; then
    hornetShimmerApiRoutesParticipationAddresses=ON
else
    hornetShimmerApiRoutesParticipationAddresses=OFF
    hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes,/api/plugins/participation/v2/addresses*")
fi

######

hornetShimmerApiPublicRoutes=$(echo "$hornetShimmerApiPublicRoutes" | tr -s ',,' ',')
validateHornetShimmerApiPublicRoutes=$(echo "${hornetShimmerApiPublicRoutes: -1}")
if [ "$validateHornetShimmerApiPublicRoutes" = "," ]; then
    hornetShimmerApiPublicRoutes="${hornetShimmerApiPublicRoutes%?}"
fi

if [ "$hornetShimmerUpdateApiRoutes" = "true" ]; then
    sudo sed -i 's~^hornetShimmerApiPublicRoutes=.*~hornetShimmerApiPublicRoutes="'$hornetShimmerApiPublicRoutes'"~' $swarmConfigs/hornet-shimmer.cfg
fi
