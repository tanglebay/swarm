#!/bin/bash

if [ -f "/usr/bin/iota-inx-indexer" ] && [ "$watchdogIotaInxIndexerApiCheck" = "true" ] && [ "$watchdogIotaInxIndexerApiCheckOutput" ] && [ "$iotaInxIndexerStatus" = "active" ]; then
    watchdogIotaInxIndexerApiCheckOutputResult=$(curl -sL localhost:14265/api/indexer/v1/outputs?unlockableByAddress=$watchdogIotaInxIndexerApiCheckOutput)
    if [[ $watchdogIotaInxIndexerApiCheckOutputResult = *jwt* ]]; then
        systemctl stop iota-inx-indexer > /dev/null 2>&1
        rm -rf $iotaInxDashboardHome/database > /dev/null 2>&1
        systemctl start iota-inx-indexer > /dev/null 2>&1
    fi
    unset watchdogIotaInxIndexerApiCheckOutputResult
fi

if [ -f "/usr/bin/shimmer-inx-indexer" ] && [ "$watchdogShimmerInxIndexerApiCheck" = "true" ] && [ "$watchdogShimmerInxIndexerApiCheckOutput" ] && [ "$shimmerInxIndexerStatus" = "active" ]; then
    watchdogShimmerInxIndexerApiCheckOutputResult=$(curl -sL localhost:14266/api/indexer/v1/outputs?unlockableByAddress=$watchdogShimmerInxIndexerApiCheckOutput)
    if [[ $watchdogShimmerInxIndexerApiCheckOutputResult = *jwt* ]]; then
        systemctl stop shimmer-inx-indexer > /dev/null 2>&1
        rm -rf $shimmerInxDashboardHome/database > /dev/null 2>&1
        systemctl start shimmer-inx-indexer > /dev/null 2>&1
    fi
    unset watchdogShimmerInxIndexerApiCheckOutputResult
fi