#!/bin/bash
source $swarmConfigs/watchdog.cfg

################################################################################################################################################

# Hornet
if [ -n "$iotaHornetStatusCounter" ]; then
    if [ $iotaHornetStatusCounter -ne $iotaHornetStatusCounter ] 2>/dev/null; then
        hornetStatusCounter=0
        sudo sed -i 's/^iotaHornetStatusCounter=.*/iotaHornetStatusCounter='$iotaHornetStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    iotaHornetStatusCounter=0
    sudo sed -i 's/^iotaHornetStatusCounter=.*/iotaHornetStatusCounter='$iotaHornetStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# Hornet Status Check
if [ "$hornetStatus" != "active" ] && [ -f "/usr/bin/hornet" ] && [ "$hornetServiceStatusCheck" = "true" ]; then
    sudo systemctl stop hornet 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [[ $hornetPlugins = *participation* ]] && [ $hornetStatusCounter -ge 1 ] 2>/dev/null; then
        sudo rm -rf $hornetHome/${hornetNetwork}db/participation 2>/dev/null
    fi
    if [ $hornetStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$hornetAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL hornet 2>/dev/null
            fi
            sudo rm -rf $hornetHome/${hornetNetwork}db $hornetHome/snapshots/${hornetNetwork}/*.bin
            echo "$restartDate [WACHTDOG] HORNET ${hornetNetwork}DB deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] HORNET ${hornetNetwork}DB deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        hornetStatusCounter=0
    else
        let hornetStatusCounter=$hornetStatusCounter+1
    fi
    sudo systemctl start hornet 2>/dev/null
    sudo sed -i 's/^hornetStatusCounter=.*/hornetStatusCounter='$hornetStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] HORNET node was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] HORNET node was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $hornetStatusCounter -gt 0 ] 2>/dev/null; then
        let hornetStatusCounter=$hornetStatusCounter-1
        sudo sed -i 's/^hornetStatusCounter=.*/hornetStatusCounter='$hornetStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# Bee
if [ -n "$iotaBeeStatusCounter" ]; then
    if [ $iotaBeeStatusCounter -ne $iotaBeeStatusCounter ] 2>/dev/null; then
        iotaBeeStatusCounter=0
        sudo sed -i 's/^iotaBeeStatusCounter=.*/iotaBeeStatusCounter='$iotaBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    iotaBeeStatusCounter=0
    sudo sed -i 's/^iotaBeeStatusCounter=.*/iotaBeeStatusCounter='$iotaBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# Bee Status Check
if [ "$iotaBeeStatus" != "active" ] && [ -f "/usr/bin/iota-bee" ] && [ "$iotaBeeServiceStatusCheck" = "true" ]; then
    sudo systemctl stop iota-bee 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $iotaBeeStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$iotaBeeAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL iota-bee 2>/dev/null
            fi
            sudo rm -rf $iotaBeeHome/storage/$iotaBeeNetwork $iotaBeeHome/snapshots/$iotaBeeNetwork
            echo "$restartDate [WACHTDOG] BEE (IOTA) ${iotaBeeNetwork}DB deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] BEE (IOTA) ${iotaBeeNetwork}DB deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        iotaBeeStatusCounter=0
    else
        let iotaBeeStatusCounter=$iotaBeeStatusCounter+1
    fi
    sudo systemctl start bee 2>/dev/null
    sudo sed -i 's/^iotaBeeStatusCounter=.*/iotaBeeStatusCounter='$iotaBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] BEE node was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] BEE node was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $iotaBeeStatusCounter -gt 0 ] 2>/dev/null; then
        let iotaBeeStatusCounter=$iotaBeeStatusCounter-1
        sudo sed -i 's/^iotaBeeStatusCounter=.*/iotaBeeStatusCounter='$iotaBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Dashboard
if [ -n "$iotaInxDashboardStatusCounter" ]; then
    if [ $iotaInxDashboardStatusCounter -ne $iotaInxDashboardStatusCounter ] 2>/dev/null; then
        iotaInxDashboardStatusCounter=0
        sudo sed -i 's/^iotaInxDashboardStatusCounter=.*/iotaInxDashboardStatusCounter='$iotaInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    iotaInxMDashboardStatusCounter=0
    sudo sed -i 's/^iotaInxDashboardStatusCounter=.*/iotaInxDashboardStatusCounter='$iotaInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Dashboard (IOTA) Status Check
if [ "$iotaInxDashboardStatus" != "active" ] && [ -f "/usr/bin/iota-inx-dashboard" ] && [ "$iotaInxDashboardServiceStatusCheck" = "true" ]; then
    sudo systemctl stop iota-inx-dashboard 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $iotaInxDashboardStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$iotaInxDashboardAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL iota-inx-dashboard 2>/dev/null
            fi
            sudo rm -rf $iotaInxDashboardHome/database
            echo "$restartDate [WACHTDOG] INX-Dashboard (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-Dashboard (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        iotaInxDashboardStatusCounter=0
    else
        let iotaInxDashboardStatusCounter=$iotaInxDashboardStatusCounter+1
    fi
    sudo systemctl start iota-inx-dashboard 2>/dev/null
    sudo sed -i 's/^iotaInxDashboardStatusCounter=.*/iotaInxDashboardStatusCounter='$iotaInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-Dashboard (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-Dashboard (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $iotaInxDashboardStatusCounter -gt 0 ] 2>/dev/null; then
        let iotaInxDashboardStatusCounter=$iotaInxDashboardStatusCounter-1
        sudo sed -i 's/^iotaInxDashboardStatusCounter=.*/iotaInxDashboardStatusCounter='$iotaInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Indexer
if [ -n "$iotaInxIndexerStatusCounter" ]; then
    if [ $iotaInxIndexerStatusCounter -ne $iotaInxIndexerStatusCounter ] 2>/dev/null; then
        iotaIndexerStatusCounter=0
        sudo sed -i 's/^iotaInxIndexerStatusCounter=.*/iotaInxIndexerStatusCounter='$iotaInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    iotaInxIndexerStatusCounter=0
    sudo sed -i 's/^iotaInxIndexerStatusCounter=.*/iotaInxIndexerStatusCounter='$iotaInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Indexer (IOTA) Status Check
if [ "$iotaInxIndexerStatus" != "active" ] && [ -f "/usr/bin/iota-inx-indexer" ] && [ "$iotaInxIndexerServiceStatusCheck" = "true" ]; then
    sudo systemctl stop iota-inx-indexer 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $iotaInxIndexerStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$iotaInxIndexerAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL iota-inx-indexer 2>/dev/null
            fi
            sudo rm -rf $iotaInxIndexerHome/database
            echo "$restartDate [WACHTDOG] INX-Indexer (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-Indexer (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        iotaInxIndexerStatusCounter=0
    else
        let iotaInxIndexerStatusCounter=$iotaInxIndexerStatusCounter+1
    fi
    sudo systemctl start iota-inx-indexer 2>/dev/null
    sudo sed -i 's/^iotaInxIndexerStatusCounter=.*/iotaInxIndexerStatusCounter='$iotaInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-Indexer (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-Indexer (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $iotaInxIndexerStatusCounter -gt 0 ] 2>/dev/null; then
        let iotaInxIndexerStatusCounter=$iotaInxIndexerStatusCounter-1
        sudo sed -i 's/^iotaInxIndexerStatusCounter=.*/iotaInxIndexerStatusCounter='$iotaInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Mqtt
if [ -n "$iotaInxMqttStatusCounter" ]; then
    if [ $iotaInxMqttStatusCounter -ne $iotaInxMqttStatusCounter ] 2>/dev/null; then
        iotaInxMqttStatusCounter=0
        sudo sed -i 's/^iotaInxMqttStatusCounter=.*/iotaInxMqttStatusCounter='$iotaInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    iotaInxMqttStatusCounter=0
    sudo sed -i 's/^iotaInxMqttStatusCounter=.*/iotaInxMqttStatusCounter='$iotaInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Mqtt (IOTA) Status Check
if [ "$iotaInxMqttStatus" != "active" ] && [ -f "/usr/bin/iota-inx-mqtt" ] && [ "$iotaInxMqttServiceStatusCheck" = "true" ]; then
    sudo systemctl stop iota-inx-mqtt 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $iotaInxMqttStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$iotaInxMqttAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL iota-inx-mqtt 2>/dev/null
            fi
            sudo rm -rf $iotaInxMqttHome/database
            echo "$restartDate [WACHTDOG] INX-MQTT (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-MQTT (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        iotaInxMqttStatusCounter=0
    else
        let iotaInxMqttStatusCounter=$iotaInxMqttStatusCounter+1
    fi
    sudo systemctl start iota-inx-mqtt 2>/dev/null
    sudo sed -i 's/^iotaInxMqttStatusCounter=.*/iotaInxMqttStatusCounter='$iotaInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-MQTT (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-MQTT (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $iotaInxMqttStatusCounter -gt 0 ] 2>/dev/null; then
        let iotaInxMqttStatusCounter=$iotaInxMqttStatusCounter-1
        sudo sed -i 's/^iotaInxMqttStatusCounter=.*/iotaInxMqttStatusCounter='$iotaInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Participation
if [ -n "$iotaInxParticipationStatusCounter" ]; then
    if [ $iotaInxParticipationStatusCounter -ne $iotaInxParticipationStatusCounter ] 2>/dev/null; then
        iotaInxParticipationStatusCounter=0
        sudo sed -i 's/^iotaInxParticipationStatusCounter=.*/iotaInxParticipationStatusCounter='$iotaInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    inxParticipationStatusCounter=0
    sudo sed -i 's/^iotaInxParticipationStatusCounter=.*/iotaInxParticipationStatusCounter='$iotaInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Participation (IOTA) Status Check
if [ "$iotaInxParticipationStatus" != "active" ] && [ -f "/usr/bin/iota-inx-participation" ] && [ "$iotaInxParticipationServiceStatusCheck" = "true" ]; then
    sudo systemctl stop iota-inx-participation 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $iotaInxParticipationStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$iotaInxParticipationAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL iota-inx-participation 2>/dev/null
            fi
            sudo rm -rf $iotaInxParticipationHome/database
            echo "$restartDate [WACHTDOG] INX-Participation (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-Participation (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        iotaInxParticipationStatusCounter=0
    else
        let iotaInxParticipationStatusCounter=$iotaInxParticipationStatusCounter+1
    fi
    sudo systemctl start iota-inx-participation 2>/dev/null
    sudo sed -i 's/^iotaInxParticipationStatusCounter=.*/iotaInxParticipationStatusCounter='$iotaInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-Participation (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-Participation (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $iotaInxParticipationStatusCounter -gt 0 ] 2>/dev/null; then
        let iotaInxParticipationStatusCounter=$iotaInxParticipationStatusCounter-1
        sudo sed -i 's/^iotaInxParticipationStatusCounter=.*/iotaInxParticipationStatusCounter='$iotaInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

########################################################################################################################################################################

# Hornet-Shimmer
if [ -n "$shimmerHornetStatusCounter" ]; then
    if [ $shimmerHornetStatusCounter -ne $shimmerHornetStatusCounter ] 2>/dev/null; then
        shimmerHornetStatusCounter=0
        sudo sed -i 's/^shimmerHornetStatusCounter=.*/shimmerHornetStatusCounter='$shimmerHornetStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    shimmerHornetStatusCounter=0
    sudo sed -i 's/^shimmerHornetStatusCounter=.*/shimmerHornetStatusCounter='$shimmerHornetStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# Hornet-Shimmer Status Check
if [ "$shimmerHornetStatus" != "active" ] && [ -f "/usr/bin/hornet-shimmer" ] && [ "$shimmerHornetServiceStatusCheck" = "true" ]; then
    sudo systemctl stop hornet-shimmer 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [[ $shimmerHornetPlugins = *participation* ]] && [ $shimmerHornetStatusCounter -ge 1 ] 2>/dev/null; then
        sudo rm -rf $shimmerHornetHome/${shimmerHornetNetwork}/database/participation 2>/dev/null
    fi
    if [ $shimmerHornetStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$shimmerHornetAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL hornet-shimmer 2>/dev/null
            fi
            sudo rm -rf $shimmerHornetHome/${shimmerHornetNetwork}/database $shimmerHornetHome/${shimmerHornetNetwork}/snapshots/*.bin
            echo "$restartDate [WACHTDOG] HORNET (Shimmer) ${shimmerHornetNetwork}DB deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] HORNET (Shimmer) ${shimmerHornetNetwork}DB deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        shimmerHornetStatusCounter=0
    else
        let shimmerHornetStatusCounter=$shimmerHornetStatusCounter+1
    fi
    sudo systemctl start hornet-shimmer 2>/dev/null
    sudo sed -i 's/^shimmerHornetStatusCounter=.*/shimmerHornetStatusCounter='$shimmerHornetStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] HORNET (Shimmer) node was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] HORNET (Shimmer) node was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $shimmerHornetStatusCounter -gt 0 ] 2>/dev/null; then
        let shimmerHornetStatusCounter=$shimmerHornetStatusCounter-1
        sudo sed -i 's/^shimmerHornetStatusCounter=.*/shimmerHornetStatusCounter='$shimmerHornetStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# Bee-Shimmer
if [ -n "$shimmerBeeStatusCounter" ]; then
    if [ $shimmerBeeStatusCounter -ne $shimmerBeeStatusCounter ] 2>/dev/null; then
        shimmerBeeStatusCounter=0
        sudo sed -i 's/^shimmerBeeStatusCounter=.*/shimmerBeeStatusCounter='$shimmerBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    shimmerBeeStatusCounter=0
    sudo sed -i 's/^shimmerBeeStatusCounter=.*/shimmerBeeStatusCounter='$shimmerBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# Bee-Shimmer Status Check
if [ "$shimmerBeeStatus" != "active" ] && [ -f "/usr/bin/shimmer-bee" ] && [ "$shimmerBeeServiceStatusCheck" = "true" ]; then
    sudo systemctl stop shimmer-bee 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $shimmerBeeStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$shimmerBeeAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL shimmer-bee 2>/dev/null
            fi
            sudo rm -rf $shimmerBeeHome/storage/$shimmerBeeNetwork $shimmerBeeHome/snapshots/$shimmerBeeNetwork
            echo "$restartDate [WACHTDOG] Bee (Shimmer) ${shimmerBeeNetwork}DB deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] Bee (Shimmer) ${shimmerBeeNetwork}DB deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        shimmerBeeStatusCounter=0
    else
        let shimmerBeeStatusCounter=$shimmerBeeStatusCounter+1
    fi
    sudo systemctl start shimmer-bee 2>/dev/null
    sudo sed -i 's/^shimmerBeeStatusCounter=.*/shimmerBeeStatusCounter='$shimmerBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] Bee (Shimmer) node was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] Bee (Shimmer) node was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $shimmerBeeStatusCounter -gt 0 ] 2>/dev/null; then
        let shimmerBeeStatusCounter=$shimmerBeeStatusCounter-1
        sudo sed -i 's/^shimmerBeeStatusCounter=.*/shimmerBeeStatusCounter='$shimmerBeeStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Dashboard (Shimmer)
if [ -n "$shimmerInxDashboardStatusCounter" ]; then
    if [ $shimmerInxDashboardStatusCounter -ne $shimmerInxDashboardStatusCounter ] 2>/dev/null; then
        shimmerDashboardStatusCounter=0
        sudo sed -i 's/^shimmerInxDashboardStatusCounter=.*/shimmerInxDashboardStatusCounter='$shimmerInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    shimmerInxDashboardStatusCounter=0
    sudo sed -i 's/^shimmerInxDashboardStatusCounter=.*/shimmerInxDashboardStatusCounter='$shimmerInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Dashboard Status Check
if [ "$shimmerInxDashboardStatus" != "active" ] && [ -f "/usr/bin/shimmer-inx-dashboard" ] && [ "$shimmerInxDashboardServiceStatusCheck" = "true" ]; then
    sudo systemctl stop shimmer-inx-dashboard 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $shimmerInxDashboardStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$shimmerInxDashboardAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL shimmer-inx-dashboard 2>/dev/null
            fi
            sudo rm -rf $shimmerInxDashboardHome/database
            echo "$restartDate [WACHTDOG] INX-Dashboard (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-Dashboard (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        shimmerInxDashboardStatusCounter=0
    else
        let shimmerInxDashboardStatusCounter=$shimmerInxDashboardStatusCounter+1
    fi
    sudo systemctl start shimmer-inx-dashboard 2>/dev/null
    sudo sed -i 's/^shimmerInxDashboardStatusCounter=.*/shimmerInxDashboardStatusCounter='$shimmerInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-Dashboard (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-Dashboard (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $shimmerInxDashboardStatusCounter -gt 0 ] 2>/dev/null; then
        let shimmerInxDashboardStatusCounter=$shimmerInxDashboardStatusCounter-1
        sudo sed -i 's/^shimmerInxDashboardStatusCounter=.*/shimmerInxDashboardStatusCounter='$shimmerInxDashboardStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Indexer (Shimmer)
if [ -n "$shimmerInxIndexerStatusCounter" ]; then
    if [ $shimmerInxIndexerStatusCounter -ne $shimmerInxIndexerStatusCounter ] 2>/dev/null; then
        shimmerIndexerStatusCounter=0
        sudo sed -i 's/^shimmerInxIndexerStatusCounter=.*/shimmerInxIndexerStatusCounter='$shimmerInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    shimmerInxIndexerStatusCounter=0
    sudo sed -i 's/^shimmerInxIndexerStatusCounter=.*/shimmerInxIndexerStatusCounter='$shimmerInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Indexer Status Check
if [ "$shimmerInxIndexerStatus" != "active" ] && [ -f "/usr/bin/shimmer-inx-indexer" ] && [ "$shimmerInxIndexerServiceStatusCheck" = "true" ]; then
    sudo systemctl stop shimmer-inx-indexer 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $shimmerInxIndexerStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$shimmerInxIndexerAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL shimmer-inx-indexer 2>/dev/null
            fi
            sudo rm -rf $shimmerInxIndexerHome/database
            echo "$restartDate [WACHTDOG] INX-Indexer (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-Indexer (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        shimmerInxIndexerStatusCounter=0
    else
        let shimmerInxIndexerStatusCounter=$shimmerInxIndexerStatusCounter+1
    fi
    sudo systemctl start shimmer-inx-indexer 2>/dev/null
    sudo sed -i 's/^shimmerInxIndexerStatusCounter=.*/shimmerInxIndexerStatusCounter='$shimmerInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-Indexer (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-Indexer (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $shimmerInxIndexerStatusCounter -gt 0 ] 2>/dev/null; then
        let shimmerInxIndexerStatusCounter=$shimmerInxIndexerStatusCounter-1
        sudo sed -i 's/^shimmerInxIndexerStatusCounter=.*/shimmerInxIndexerStatusCounter='$shimmerInxIndexerStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Mqtt (Shimmer)
if [ -n "$shimmerInxMqttStatusCounter" ]; then
    if [ $shimmerInxMqttStatusCounter -ne $shimmerInxMqttStatusCounter ] 2>/dev/null; then
        shimmerInxMqttStatusCounter=0
        sudo sed -i 's/^shimmerInxMqttStatusCounter=.*/shimmerInxMqttStatusCounter='$shimmerInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    shimmerInxMqttStatusCounter=0
    sudo sed -i 's/^shimmerInxMqttStatusCounter=.*/shimmerInxMqttStatusCounter='$shimmerInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Mqtt Status Check
if [ "$shimmerInxMqttStatus" != "active" ] && [ -f "/usr/bin/shimmer-inx-mqtt" ] && [ "$shimmerInxMqttServiceStatusCheck" = "true" ]; then
    sudo systemctl stop shimmer-inx-mqtt 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $shimmerInxMqttStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$shimmerInxMqttAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL shimmer-inx-mqtt 2>/dev/null
            fi
            sudo rm -rf $shimmerInxMqttHome/database
            echo "$restartDate [WACHTDOG] INX-MQTT (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-MQTT (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        shimmerInxMqttStatusCounter=0
    else
        let shimmerInxMqttStatusCounter=$shimmerInxMqttStatusCounter+1
    fi
    sudo systemctl start shimmer-inx-mqtt 2>/dev/null
    sudo sed -i 's/^shimmerInxMqttStatusCounter=.*/shimmerInxMqttStatusCounter='$shimmerInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-MQTT (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-MQTT (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $shimmerInxMqttStatusCounter -gt 0 ] 2>/dev/null; then
        let shimmerInxMqttStatusCounter=$shimmerInxMqttStatusCounter-1
        sudo sed -i 's/^shimmerInxMqttStatusCounter=.*/shimmerInxMqttStatusCounter='$shimmerInxMqttStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# INX-Participation (Shimmer)
if [ -n "$shimmerInxParticipationStatusCounter" ]; then
    if [ $shimmerInxParticipationStatusCounter -ne $shimmerInxParticipationStatusCounter ] 2>/dev/null; then
        shimmerInxParticipationStatusCounter=0
        sudo sed -i 's/^shimmerInxParticipationStatusCounter=.*/shimmerInxParticipationStatusCounter='$shimmerInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    inxParticipationStatusCounter=0
    sudo sed -i 's/^shimmerInxParticipationStatusCounter=.*/shimmerInxParticipationStatusCounter='$shimmerInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# INX-Participation Status Check
if [ "$shimmerInxParticipationStatus" != "active" ] && [ -f "/usr/bin/shimmer-inx-participation" ] && [ "$shimmerInxParticipationServiceStatusCheck" = "true" ]; then
    sudo systemctl stop shimmer-inx-participation 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $shimmerInxParticipationStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$shimmerInxParticipationAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL shimmer-inx-participation 2>/dev/null
            fi
            sudo rm -rf $shimmerInxParticipationHome/database
            echo "$restartDate [WACHTDOG] INX-Participation (IOTA) database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] INX-Participation (IOTA) database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        shimmerInxParticipationStatusCounter=0
    else
        let shimmerInxParticipationStatusCounter=$shimmerInxParticipationStatusCounter+1
    fi
    sudo systemctl start shimmer-inx-participation 2>/dev/null
    sudo sed -i 's/^shimmerInxParticipationStatusCounter=.*/shimmerInxParticipationStatusCounter='$shimmerInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] INX-Participation (IOTA) was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] INX-Participation (IOTA) was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $shimmerInxParticipationStatusCounter -gt 0 ] 2>/dev/null; then
        let shimmerInxParticipationStatusCounter=$shimmerInxParticipationStatusCounter-1
        sudo sed -i 's/^shimmerInxParticipationStatusCounter=.*/shimmerInxParticipationStatusCounter='$shimmerInxParticipationStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

########################################################################################################################################################################

# GoShimmer
if [ -n "$goshimmerStatusCounter" ]; then
    if [ $goshimmerStatusCounter -ne $goshimmerStatusCounter ] 2>/dev/null; then
        goshimmerStatusCounter=0
        sudo sed -i 's/^goshimmerStatusCounter=.*/goshimmerStatusCounter='$goshimmerStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    goshimmerStatusCounter=0
    sudo sed -i 's/^goshimmerStatusCounter=.*/goshimmerStatusCounter='$goshimmerStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# GoShimmer Status Check
if [ "$goshimmerStatus" != "active" ] && [ -f "/usr/bin/goshimmer" ] && [ ! -f "/tmp/goshimmer.lock" ]; then
    sudo systemctl stop goshimmer 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $goshimmerStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$goshimmerAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL goshimmer 2>/dev/null
            fi
            sudo rm -rf $goshimmerHome/mainnetdb $goshimmerHome/peerdb 2>/dev/null
            source $goshimmerModules/goshimmerDbDownload
            echo "$restartDate [WACHTDOG] GOSHIMMER database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] GOSHIMMER database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        goshimmerStatusCounter=0
    else
        let goshimmerStatusCounter=$goshimmerStatusCounter+1
    fi
    sudo systemctl start goshimmer 2>/dev/null
    sudo sed -i 's/^goshimmerStatusCounter=.*/goshimmerStatusCounter='$goshimmerStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] GOSHIMMER node was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] GOSHIMMER node was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $goshimmerStatusCounter -gt 0 ] 2>/dev/null; then
        let goshimmerStatusCounter=$goshimmerStatusCounter-1
        sudo sed -i 's/^goshimmerStatusCounter=.*/goshimmerStatusCounter='$goshimmerStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi

# Wasp
if [ -n "$waspStatusCounter" ]; then
    if [ $waspStatusCounter -ne $waspStatusCounter ] 2>/dev/null; then
        waspStatusCounter=0
        sudo sed -i 's/^waspStatusCounter=.*/waspStatusCounter='$waspStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
else
    waspStatusCounter=0
    sudo sed -i 's/^waspStatusCounter=.*/waspStatusCounter='$waspStatusCounter'/' $swarmConfigs/watchdog.cfg
fi
# WASP Status Check
if [ "$waspStatus" != "active" ] && [ -f "/usr/bin/wasp" ]; then
    sudo systemctl stop wasp 2>/dev/null
    restartDate=`date '+%d-%m-%Y %H-%M-%S'`
    if [ $waspStatusCounter -ge 2 ] 2>/dev/null; then
        if [ "$waspAllowDbReset" = "true" ]; then
            if [ "$killall" = "true" ]; then
                sudo killall -s SIGKILL wasp 2>/dev/null
            fi
            sudo rm -rf $waspHome/waspdb
            echo "$restartDate [WACHTDOG] WASP database deleted because the maximum number of attempted restarts was reached." >> $swarmLogs/swarm.log
            telegramText="[$HOSTNAME] WASP database deleted because the maximum number of attempted restarts was reached."
            source $watchdogModules/watchdogTelegram
        fi
        waspStatusCounter=0
    else
        let waspStatusCounter=$waspStatusCounter+1
    fi
    sudo systemctl start wasp 2>/dev/null
    sudo sed -i 's/^waspStatusCounter=.*/waspStatusCounter='$waspStatusCounter'/' $swarmConfigs/watchdog.cfg
    echo "$restartDate [WACHTDOG] WASP node was restarted because the service is not active." >> $swarmLogs/swarm.log
    telegramText="[$HOSTNAME] WASP node was restarted because the service is not active."
    source $watchdogModules/watchdogTelegram
else
    if [ $waspStatusCounter -gt 0 ] 2>/dev/null; then
        let waspStatusCounter=$waspStatusCounter-1
        sudo sed -i 's/^waspStatusCounter=.*/waspStatusCounter='$waspStatusCounter'/' $swarmConfigs/watchdog.cfg
    fi
fi