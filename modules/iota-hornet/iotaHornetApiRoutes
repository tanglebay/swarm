#!/bin/bash

# Unset VARS
unset iotaHornetApiPublicRoutes

# /health
if [[ $iotaHornetApiRoutes = */health* ]]; then
    iotaHornetApiRoutesHealth=OFF
else
    iotaHornetApiRoutesHealth=ON
    iotaHornetApiPublicRoutes="/health"
fi

# /mqtt
if [[ $iotaHornetApiRoutes = */mqtt* ]]; then
    iotaHornetApiRoutesMqtt=OFF
else
    iotaHornetApiRoutesMqtt=ON
    iotaHornetApiPublicRoutes="$iotaHornetApiPublicRoutes,/mqtt"
fi

# /api/v1/info
if [[ $iotaHornetApiRoutes = */api/v1/info* ]]; then
    iotaHornetApiRoutesInfo=OFF
else
    iotaHornetApiRoutesInfo=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/info")
fi

# /api/v1/tips
if [[ $iotaHornetApiRoutes = */api/v1/tips* ]]; then
    iotaHornetApiRoutesTips=OFF
else
    iotaHornetApiRoutesTips=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/tips")
fi

# /api/v1/messages
if [[ $iotaHornetApiRoutes = */api/v1/messages\** ]]; then
    iotaHornetApiRoutesMessages=OFF
else
    iotaHornetApiRoutesMessages=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/messages*")
fi

#/api/v1/transactions
if [[ $iotaHornetApiRoutes = */api/v1/transactions\** ]]; then
    iotaHornetApiRoutesTransactions=OFF
else
    iotaHornetApiRoutesTransactions=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/transactions*")
fi

#/api/v1/milestones
if [[ $iotaHornetApiRoutes = */api/v1/milestones\** ]]; then
    iotaHornetApiRoutesMilestones=OFF
else
    iotaHornetApiRoutesMilestones=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/milestones*")
fi

#/api/v1/outputs
if [[ $iotaHornetApiRoutes = */api/v1/outputs\** ]]; then
    iotaHornetApiRoutesOutputs=OFF
else
    iotaHornetApiRoutesOutputs=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/outputs*")
fi

#/api/v1/addresses
if [[ $iotaHornetApiRoutes = */api/v1/addresses\** ]]; then
    iotaHornetApiRoutesAddresses=OFF
else
    iotaHornetApiRoutesAddresses=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/addresses*")
fi

#/api/v1/treasury
if [[ $iotaHornetApiRoutes = */api/v1/treasury* ]]; then
    iotaHornetApiRoutesTreasury=OFF
else
    iotaHornetApiRoutesTreasury=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/treasury")
fi

#/api/v1/receipts
if [[ $iotaHornetApiRoutes = */api/v1/receipts\** ]]; then
    iotaHornetApiRoutesReceipts=OFF
else
    iotaHornetApiRoutesReceipts=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/v1/receipts*")
fi

#/api/plugins/participation/events*
if [[ $iotaHornetApiRoutes = */api/plugins/participation/events\** ]]; then
    iotaHornetApiRoutesParticipationEvents=OFF
else
    iotaHornetApiRoutesParticipationEvents=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/plugins/participation/events*")
fi

if [[ $iotaHornetApiRoutes = */api/plugins/participation/outputs\** ]]; then
    iotaHornetApiRoutesParticipationOutputs=OFF
else
    iotaHornetApiRoutesParticipationOutputs=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/plugins/participation/outputs*")
fi

if [[ $iotaHornetApiRoutes = */api/plugins/participation/addresses\** ]]; then
    iotaHornetApiRoutesParticipationAddresses=OFF
else
    iotaHornetApiRoutesParticipationAddresses=ON
    iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes,/api/plugins/participation/addresses*")
fi

######

iotaHornetApiPublicRoutes=$(echo "$iotaHornetApiPublicRoutes" | tr -s ',,' ',')
validateIotaHornetApiPublicRoutes=$(echo "${iotaHornetApiPublicRoutes: -1}")
if [ "$validateIotaHornetApiPublicRoutes" = "," ]; then
    iotaHornetApiPublicRoutes="${iotaHornetApiPublicRoutes%?}"
fi

if [ "$iotaHornetUpdateApiRoutes" = "true" ]; then
    sudo sed -i 's~^iotaHornetApiPublicRoutes=.*~iotaHornetApiPublicRoutes="'$iotaHornetApiPublicRoutes'"~' $swarmConfigs/iota-hornet.cfg
fi
