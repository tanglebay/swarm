#!/bin/bash

if [ "$(printf '%s\n' "$iotaHornetStardustMinVersion" "$iotaHornetVersion" | sort -V | head -n1)" != "$iotaHornetStardustMinVersion" ] && [ ! -z "$iotaHornetVersion" ]; then
    parser="$(jq '.node.alias' $iotaHornetHome/$iotaHornetConfig.json)"
    parser=$(echo $parser | tr -d '"')
    if [ "$iotaHornetAlias" != "$parser" ]; then
        if [ ! -z "$iotaHornetAlias" ]; then
            sudo jq --arg iotaHornetAlias "$iotaHornetAlias" '.node.alias = ($iotaHornetAlias)' $iotaHornetHome/$iotaHornetConfig.json | sponge $iotaHornetHome/$iotaHornetConfig.json
            restartIotaHornet=true
            newIotaHornetAlias=true
            echo "iotaHornetAlias" >> /tmp/iotaHornetParsing
        fi
    fi
else
    parser="$(jq '.node.alias' $iotaHornetHome/$iotaHornetConfig.json)"
    parser=$(echo $parser | tr -d '"')
    if [ "$iotaHornetAlias" != "$parser" ]; then
        if [ ! -z "$iotaHornetAlias" ]; then
            sudo jq --arg iotaHornetAlias "$iotaHornetAlias" '.node.alias = ($iotaHornetAlias)' $iotaHornetHome/$iotaHornetConfig.json|sponge $iotaHornetHome/$iotaHornetConfig.json
            restartIotaHornet=true
            newIotaHornetAlias=true
            echo "iotaHornetAlias" >> /tmp/iotaHornetParsing
        fi
    fi
fi