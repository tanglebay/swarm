#!/bin/bash

if [[ $iotaHornetVersion =~ ^1.* ]]; then
    parser=$(jq '.restAPI.bindAddress' $iotaHornetHome/$iotaHornetConfig.json)
    parser=$(echo $parser | tr -d '"')
    if [ "$parser" != "0.0.0.0:14265" ]; then
        sudo jq '.restAPI.bindAddress = "0.0.0.0:14265"' $iotaHornetHome/$iotaHornetConfig.json|sponge $iotaHornetHome/$iotaHornetConfig.json
        if [ -f "/etc/nginx/sites-enabled/iota-hornet" ]; then
            sudo find /etc/nginx/sites-enabled/iota-hornet -type f -exec sed -i 's/14266/14265/g' {} \;
            sudo systemctl reload nginx
        fi
        restartIotaHornet=true
        echo "iotaHornetRestApiPort" >> /tmp/iotaHornetParsing
    fi
fi
