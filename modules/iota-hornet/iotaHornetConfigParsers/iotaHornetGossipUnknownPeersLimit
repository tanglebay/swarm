#!/bin/bash

if [ "$iotaHornetReleaseVersion" = "v2" ] && [ ! -z "$iotaHornetReleaseVersion" ] && [[ $iotaHornetVersion =~ ^2.* ]]; then
    if [ -n "$iotaHornetUnknownPeersLimit" ] && [ "$iotaHornetUnknownPeersLimit" -ge 0 ] 2>/dev/null; then
        parser="$(jq '.p2p.gossip.unknownPeersLimit' $iotaHornetHome/$iotaHornetConfig.json)"
        if [ "$parser" != "$iotaHornetUnknownPeersLimit" ]; then
            sudo jq '.p2p.gossip.unknownPeersLimit = '$iotaHornetUnknownPeersLimit'' $iotaHornetHome/$iotaHornetConfig.json|sponge $iotaHornetHome/$iotaHornetConfig.json
            restartIotaHornet=true
            echo "iotaHornetGossipUnknownPeersLimit" >> /tmp/iotaHornetParsing
        fi
    fi
else
    if [ -n "$iotaHornetUnknownPeersLimit" ] && [ "$iotaHornetUnknownPeersLimit" -ge 0 ] 2>/dev/null; then
        parser="$(jq '.p2p.gossip.unknownPeersLimit' $iotaHornetHome/$iotaHornetConfig.json)"
        if [ "$parser" != "$iotaHornetUnknownPeersLimit" ]; then
            sudo jq '.p2p.gossip.unknownPeersLimit = '$iotaHornetUnknownPeersLimit'' $iotaHornetHome/$iotaHornetConfig.json|sponge $iotaHornetHome/$iotaHornetConfig.json
            restartIotaHornet=true
            echo "iotaHornetGossipUnknownPeersLimit" >> /tmp/iotaHornetParsing
        fi
    fi
fi
