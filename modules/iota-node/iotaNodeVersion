#!/bin/bash

if [[ `wget -S --spider https://$cdnUrl/swarm-helper/apps.json 2>&1 | grep 'HTTP/1.1 200 OK'` ]]; then
    appsFileUrl="https://$cdnUrl/swarm-helper/apps.json"
else
    appsFileUrl="https://raw.githubusercontent.com/tanglebay/swarm-helper/main/apps.json"
fi
wget -q -O $swarmTmpPath/apps.json $appsFileUrl


latestIotaNodeVersion=$(cat $swarmTmpPath/apps.json | jq '."iota-node".'latest'')
latestIotaIndexerVersion=$(cat $swarmTmpPath/apps.json | jq '."iota-indexer".'latest'')
latestIotaMqttVersion=$(cat $swarmTmpPath/apps.json | jq '."iota-mqtt".'latest'')
latestIotaParticipationVersion=$(cat $swarmTmpPath/apps.json | jq '."iota-participation".'latest'')
latestIotaPoiVersion=$(cat $swarmTmpPath/apps.json | jq '."iota-poi".'latest'')
latestIotaIrcMetadataVersion=$(cat $swarmTmpPath/apps.json | jq '."iota-irc-metadata".'latest'')
latestIotaDashboardVersion=$(cat $swarmTmpPath/apps.json | jq '."iota-dashboard".'latest'')

# Local node version
if [ -d $iotaNodePath ]; then
    iotaNodeVersion=$( cd $swarmDockerPath ; docker compose run iota-node -v | awk '{ print $2 }' | tr -d 'v' )
else
    iotaNodeVersion="0.0.0"
fi

