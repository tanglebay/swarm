#!/bin/bash

if [ ! -z "$beeShimmerPeer1" ]; then
    parserBeeShimmerId1="$(jq '.network.peering.peers [0]' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
    beeShimmerPeerId1="{ \"address\": \"'$beeShimmerPeer1'\", \"alias\": \"'$beeShimmerPeerAlias1'\" }"
fi
if [ ! -z "$beeShimmerPeer2" ]; then
    parserBeeShimmerId2="$(jq '.network.peering.peers [1]' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
    beeShimmerPeerId2="{ \"address\": \"'$beeShimmerPeer2'\", \"alias\": \"'$beeShimmerPeerAlias2'\" }"
fi
if [ ! -z "$beeShimmerPeer3" ]; then
    parserBeeShimmerId3="$(jq '.network.peering.peers [2]' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
    beeShimmerPeerId3="{ \"address\": \"'$beeShimmerPeer3'\", \"alias\": \"'$beeShimmerPeerAlias3'\" }"
fi
if [ ! -z "$beeShimmerPeer4" ]; then
    parserBeeShimmerId4="$(jq '.network.peering.peers [3]' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
    beeShimmerPeerId1="{ \"address\": \"'$beeShimmerPeer4'\", \"alias\": \"'$beeShimmerPeerAlias4'\" }"
fi
if [ ! -z "$beeShimmerPeer5" ]; then
    parserBeeShimmerId5="$(jq '.network.peering.peers [4]' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
    beeShimmerPeerId1="{ \"address\": \"'$beeShimmerPeer5'\", \"alias\": \"'$beeShimmerPeerAlias5'\" }"
fi
if [ ! -z "$beeShimmerPeer6" ]; then
    parserBeeShimmerId6="$(jq '.network.peering.peers [5]' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
    beeShimmerPeerId1="{ \"address\": \"'$beeShimmerPeer6'\", \"alias\": \"'$beeShimmerPeerAlias6'\" }"
fi

# EMPTY ARRAY
sudo jq '.network.peering.peers = []' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json

# SET NEW PEERS
if [ "$parserBeeShimmerId1" != "$beeShimmerPeerId1" ] && [ ! -z "$beeShimmerPeer1" ]; then
    sudo jq '.network.peering.peers [0] |= . + { "address": "'$beeShimmerPeer1'", "alias": "'$beeShimmerPeerAlias1'" }' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
    restartBeeShimmer=true
fi
if [ "$parserBeeShimmerId2" != "$beeShimmerPeerId2" ] && [ ! -z "$beeShimmerPeer2" ]; then
    sudo jq '.network.peering.peers [1] |= . + { "address": "'$beeShimmerPeer2'", "alias": "'$beeShimmerPeerAlias2'" }' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
    restartBeeShimmer=true
fi
if [ "$parserBeeShimmerId3" != "$beeShimmerPeerId3" ] && [ ! -z "$beeShimmerPeer3" ]; then
    sudo jq '.network.peering.peers [2] |= . + { "address": "'$beeShimmerPeer3'", "alias": "'$beeShimmerPeerAlias3'" }' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
    restartBeeShimmer=true
fi
if [ "$parserBeeShimmerId4" != "$beeShimmerPeerId4" ] && [ ! -z "$beeShimmerPeer4" ]; then
    sudo jq '.network.peering.peers [3] |= . + { "address": "'$beeShimmerPeer4'", "alias": "'$beeShimmerPeerAlias4'" }' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
    restartBeeShimmer=true
fi
if [ "$parserBeeShimmerId5" != "$beeShimmerPeerId5" ] && [ ! -z "$beeShimmerPeer5" ]; then
    sudo jq '.network.peering.peers [4] |= . + { "address": "'$beeShimmerPeer5'", "alias": "'$beeShimmerPeerAlias5'" }' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
    restartBeeShimmer=true
fi
if [ "$parserBeeShimmerId6" != "$beeShimmerPeerId6" ] && [ ! -z "$beeShimmerPeer6" ]; then
    sudo jq '.network.peering.peers [5] |= . + { "address": "'$beeShimmerPeer6'", "alias": "'$beeShimmerPeerAlias6'" }' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
    restartBeeShimmer=true
fi
# DELETE NULL
sudo sed -i '/null,/d' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
sudo sed -i '/null/d' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
# UNSET VARS
unset parserBeeShimmerId1 parserBeeShimmerId2 parserBeeShimmerId3 parserBeeShimmerId4 parserBeeShimmerId5 parserBeeShimmerId6 beeShimmerPeerId1 beeShimmerPeerId2 beeShimmerPeerId3 beeShimmerPeerId4 beeShimmerPeerId5 beeShimmerPeerId6
