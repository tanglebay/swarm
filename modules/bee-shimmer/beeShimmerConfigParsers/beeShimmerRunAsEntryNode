#!/bin/bash

parser="$(jq '.autopeering.runAsEntryNode' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
if [ "$parser" != "$beeShimmerPowEnabled" ]; then
    sudo jq '.autopeering.runAsEntryNode = '$beeShimmerRunAsEntryNode'' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
    if [ "$beeShimmerRunAsEntryNode" = "true" ]; then
        parser="$(jq '.autopeering.enabled' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json)"
        if [ "$parser" = "false" ]; then
            beeShimmerAutopeeringEnabled=true
            sudo jq '.autopeering.enabled = '$beeShimmerAutopeeringEnabled'' $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json|sponge $beeShimmerHome/config.chrysalis-$beeShimmerNetwork.json
            sudo sed -i 's/^beeShimmerAutopeeringEnabled=.*/beeShimmerAutopeeringEnabled=true/' $swarmConfigs/bee-shimmer.cfg
        fi
    fi
    restartBeeShimmer=true
    echo "beeShimmerRunAsEntryNode" >> /tmp/beeShimmerParsing
fi

unset parser
