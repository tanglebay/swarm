#!/bin/bash

useInxMqttDisablePlugins=true
source $inxMqttModules/inxMqttPlugins

IFS=', ' read -r -a ARRAYinxMqttDisablePlugins <<< "$inxMqttDisablePlugins"

parser="$(jq '.app.disablePlugins' $inxMqttHome/$inxMqttConfig.json)"
parser="$(echo $parser | tr -d '[]" ')"
if [ "$parser" != "$inxMqttDisablePlugins" ]; then
    sudo jq '.app.disablePlugins |= []' $inxMqttHome/$inxMqttConfig.json|sponge $inxMqttHome/$inxMqttConfig.json
    for inxMqttDisablePlugin in "${ARRAYinxMqttDisablePlugins[@]}"
    do
        if [ ! -z "$inxMqttDisablePlugin" ]; then
            sudo jq '.app.disablePlugins |= .+ ["'$inxMqttDisablePlugin'"]' $inxMqttHome/$inxMqttConfig.json|sponge $inxMqttHome/$inxMqttConfig.json
        fi
    done
    restartInxMqtt=true
    echo "inxMqttDisablePlugins" >> /tmp/inxMqttParsing
fi
unset ARRAYinxMqttDisablePlugins inxMqttDisablePlugin useInxMqttDisablePlugins
