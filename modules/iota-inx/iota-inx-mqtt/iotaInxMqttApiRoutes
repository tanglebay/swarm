#!/bin/bash

iotaInxMqttApiPublicRoutesCurrent=$iotaInxMqttApiPublicRoutes

# Unset VARS
unset iotaInxMqttApiPublicRoutes

# /api/mqtt/v1
if [[ $iotaInxMqttApiRoutes = */api/mqtt/v1* ]]; then
    iotaInxMqttApiRoutesMqtt=OFF
else
    iotaInxMqttApiRoutesMqtt=ON
    iotaInxMqttApiPublicRoutes="/api/mqtt/v1"
fi

######

iotaInxMqttApiPublicRoutes=$(echo "$iotaInxMqttApiPublicRoutes" | tr -s ',,' ',')
validateIotaInxMqttApiPublicRoutes=$(echo "${iotaInxMqttApiPublicRoutes: -1}")
if [ "$validateIotaInxMqttApiPublicRoutes" = "," ]; then
    iotaInxMqttApiPublicRoutes="${iotaInxMqttApiPublicRoutes%?}"
fi

if [ "$iotaInxMqttUpdateApiRoutes" = "true" ] && [ "$iotaInxMqttApiPublicRoutes" != "$iotaInxMqttApiPublicRoutesCurrent" ]; then
    sudo sed -i 's~^iotaInxMqttApiPublicRoutes=.*~iotaInxMqttApiPublicRoutes="'$iotaInxMqttApiPublicRoutes'"~' $swarmConfigs/iota-inx-mqtt.cfg
    iotaInxMqttApiPublicRoutesUpdated=true
    restartIotaHornet=true
fi

unset iotaInxMqttApiPublicRoutesCurrent