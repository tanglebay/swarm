#!/bin/bash

# Unset VARS
unset iotaInxMqttApiPublicRoutes

# /api/mqtt/v1
if [[ $iotaInxMqttApiRoutes = */api/mqtt/v1* ]]; then
    iotaInxMqttApiRoutesMqtt=OFF
else
    iotaInxMqttApiRoutesMqtt=ON
    iotaInxMqttApiPublicRoutes="/api/mqtt/v1"
fi

######

iotaInxMqttApiPublicRoutes=$(echo "$iotaInxMqttApiPublicRoutes" | tr -s ',,' ',')
validateIotaHornetApiPublicRoutes=$(echo "${iotaInxMqttApiPublicRoutes: -1}")
if [ "$validateIotaHornetApiPublicRoutes" = "," ]; then
    iotaInxMqttApiPublicRoutes="${iotaInxMqttApiPublicRoutes%?}"
fi

if [ "$iotaInxMqttUpdateApiRoutes" = "true" ] && [ "$iotaInxMqttApiRoutes" != "$iotaInxMqttApiPublicRoutes" ]; then
    sudo sed -i 's~^iotaInxMqttApiPublicRoutes=.*~iotaInxMqttApiPublicRoutes="'$iotaInxMqttApiPublicRoutes'"~' $swarmConfigs/iota-inx-mqtt.cfg
    restartIotaHornet=true
fi
