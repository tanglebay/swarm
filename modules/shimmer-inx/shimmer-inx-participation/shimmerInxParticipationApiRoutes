#!/bin/bash

shimmerInxParticipationApiPublicRoutesCurrent=$shimmerInxParticipationApiPublicRoutes

# Unset VARS
unset shimmerInxParticipationApiPublicRoutes

#/api/participation/v1/events*
if [[ $shimmerInxParticipationApiRoutes = */api/participation/v1/events\** ]]; then
    shimmerInxParticipationApiRoutesParticipationEvents=OFF
else
    shimmerInxParticipationApiRoutesParticipationEvents=ON
    shimmerInxParticipationApiPublicRoutes="/api/participation/v1/events*"
fi

#/api/participation/v1/outputs*
if [[ $shimmerInxParticipationApiRoutes = */api/participation/v1/outputs\** ]]; then
    shimmerInxParticipationApiRoutesParticipationOutputs=OFF
else
    shimmerInxParticipationApiRoutesParticipationOutputs=ON
    shimmerInxParticipationApiPublicRoutes=$(echo "$shimmerInxParticipationApiPublicRoutes,/api/participation/v1/outputs*")
fi

#/api/participation/v1/addresses*
if [[ $shimmerInxParticipationApiRoutes = */api/participation/v1/addresses\** ]]; then
    shimmerInxParticipationApiRoutesParticipationAddresses=OFF
else
    shimmerInxParticipationApiRoutesParticipationAddresses=ON
    shimmerInxParticipationApiPublicRoutes=$(echo "$shimmerInxParticipationApiPublicRoutes,/api/participation/v1/addresses*")
fi

######

shimmerInxParticipationApiPublicRoutes=$(echo "$shimmerInxParticipationApiPublicRoutes" | tr -s ',,' ',')
validateShimmerHornetApiPublicRoutes=$(echo "${shimmerInxParticipationApiPublicRoutes: -1}")
if [ "$validateShimmerHornetApiPublicRoutes" = "," ]; then
    shimmerInxParticipationApiPublicRoutes="${shimmerInxParticipationApiPublicRoutes%?}"
fi

if [ "$shimmerInxParticipationUpdateApiRoutes" = "true" ] && [ "$shimmerInxParticipationApiPublicRoutesCurrent" != "$shimmerInxParticipationApiPublicRoutes" ]; then
    sudo sed -i 's~^shimmerInxParticipationApiPublicRoutes=.*~shimmerInxParticipationApiPublicRoutes="'$shimmerInxParticipationApiPublicRoutes'"~' $swarmConfigs/shimmer-inx-participation.cfg
    restartShimmerHornet=true
fi

unset shimmerInxParticipationApiPublicRoutesCurrent