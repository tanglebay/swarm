#!/bin/bash

shimmerInxIrcMetadataApiPublicRoutesCurrent=$shimmerInxIrcMetadataApiPublicRoutes

# Unset VARS
unset shimmerInxIrcMetadataApiPublicRoutes

#/api/irc-metadata/v1/nfts/*
if [[ $shimmerInxIrcMetadataApiRoutes = */api/irc-metadata/v1/nfts/\** ]]; then
    shimmerInxIrcMetadataApiRoutesNfts=OFF
else
    shimmerInxIrcMetadataApiRoutesNfts=ON
    shimmerInxIrcMetadataApiPublicRoutes="/api/irc-metadata/v1/nfts/*"
fi

#/api/irc-metadata/v1/tokens/*
if [[ $shimmerInxIrcMetadataApiRoutes = */api/irc-metadata/v1/tokens/\** ]]; then
    shimmerInxIrcMetadataApiRoutesTokens=OFF
else
    shimmerInxIrcMetadataApiRoutesTokens=ON
    shimmerInxIrcMetadataApiPublicRoutes=$(echo "$shimmerInxIrcMetadataApiPublicRoutes,/api/irc-metadata/v1/tokens/*")
fi

######

shimmerInxIrcMetadataApiPublicRoutes=$(echo "$shimmerInxIrcMetadataApiPublicRoutes" | tr -s ',,' ',')
validateShimmerInxIrcMetadataApiPublicRoutes=$(echo "${shimmerInxIrcMetadataApiPublicRoutes: -1}")
if [ "$validateShimmerInxIrcMetadataApiPublicRoutes" = "," ]; then
    shimmerInxIrcMetadataApiPublicRoutes="${shimmerInxIrcMetadataApiPublicRoutes%?}"
fi

if [ "$shimmerInxIrcMetadataUpdateApiRoutes" = "true" ] && [ "$shimmerInxIrcMetadataApiPublicRoutesCurrent" != "$shimmerInxIrcMetadataApiPublicRoutes" ]; then
    sudo sed -i 's~^shimmerInxIrcMetadataApiPublicRoutes=.*~shimmerInxIrcMetadataApiPublicRoutes="'$shimmerInxIrcMetadataApiPublicRoutes'"~' $swarmConfigs/shimmer-inx-irc-metadata.cfg
    shimmerInxIrcMetadataApiPublicRoutesUpdated=true
    restartShimmerHornet=true
fi

unset shimmerInxIrcMetadataApiPublicRoutesCurrent
