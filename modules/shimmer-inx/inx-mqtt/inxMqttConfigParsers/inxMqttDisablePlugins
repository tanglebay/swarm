#!/bin/bash

useShimmerInxMqttDisablePlugins=true
source $shimmerInxMqttModules/inxMqttPlugins

IFS=', ' read -r -a ARRAYshimmerInxMqttDisablePlugins <<< "$shimmerInxMqttDisablePlugins"

parser="$(jq '.app.disablePlugins' $shimmerInxMqttHome/$shimmerInxMqttConfig.json)"
parser="$(echo $parser | tr -d '[]" ')"
if [ "$parser" != "$shimmerInxMqttDisablePlugins" ]; then
    sudo jq '.app.disablePlugins |= []' $shimmerInxMqttHome/$shimmerInxMqttConfig.json|sponge $shimmerInxMqttHome/$shimmerInxMqttConfig.json
    for shimmerInxMqttDisablePlugin in "${ARRAYshimmerInxMqttDisablePlugins[@]}"
    do
        if [ ! -z "$shimmerInxMqttDisablePlugin" ]; then
            sudo jq '.app.disablePlugins |= .+ ["'$shimmerInxMqttDisablePlugin'"]' $shimmerInxMqttHome/$shimmerInxMqttConfig.json|sponge $shimmerInxMqttHome/$shimmerInxMqttConfig.json
        fi
    done
    restartShimmerInxMqtt=true
    echo "shimmerInxMqttDisablePlugins" >> /tmp/shimmerInxMqttParsing
fi
unset ARRAYshimmerInxMqttDisablePlugins shimmerInxMqttDisablePlugin useShimmerInxMqttDisablePlugins
