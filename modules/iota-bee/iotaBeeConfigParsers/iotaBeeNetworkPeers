#!/bin/bash

if [ ! -z "$iotaBeePeer1" ]; then
    parserIotaBeeId1="$(jq '.network.peering.peers [0]' $iotaBeeHome/$iotaBeeConfig.json)"
    iotaBeePeerId1="{ \"address\": \"'$iotaBeePeer1'\", \"alias\": \"'$iotaBeePeerAlias1'\" }"
fi
if [ ! -z "$iotaBeePeer2" ]; then
    parserIotaBeeId2="$(jq '.network.peering.peers [1]' $iotaBeeHome/$iotaBeeConfig.json)"
    iotaBeePeerId2="{ \"address\": \"'$iotaBeePeer2'\", \"alias\": \"'$iotaBeePeerAlias2'\" }"
fi
if [ ! -z "$iotaBeePeer3" ]; then
    parserIotaBeeId3="$(jq '.network.peering.peers [2]' $iotaBeeHome/$iotaBeeConfig.json)"
    iotaBeePeerId3="{ \"address\": \"'$iotaBeePeer3'\", \"alias\": \"'$iotaBeePeerAlias3'\" }"
fi
if [ ! -z "$iotaBeePeer4" ]; then
    parserIotaBeeId4="$(jq '.network.peering.peers [3]' $iotaBeeHome/$iotaBeeConfig.json)"
    iotaBeePeerId1="{ \"address\": \"'$iotaBeePeer4'\", \"alias\": \"'$iotaBeePeerAlias4'\" }"
fi
if [ ! -z "$iotaBeePeer5" ]; then
    parserIotaBeeId5="$(jq '.network.peering.peers [4]' $iotaBeeHome/$iotaBeeConfig.json)"
    iotaBeePeerId1="{ \"address\": \"'$iotaBeePeer5'\", \"alias\": \"'$iotaBeePeerAlias5'\" }"
fi
if [ ! -z "$iotaBeePeer6" ]; then
    parserIotaBeeId6="$(jq '.network.peering.peers [5]' $iotaBeeHome/$iotaBeeConfig.json)"
    iotaBeePeerId1="{ \"address\": \"'$iotaBeePeer6'\", \"alias\": \"'$iotaBeePeerAlias6'\" }"
fi

# EMPTY ARRAY
sudo jq '.network.peering.peers = []' $iotaBeeHome/$iotaBeeConfig.json|sponge $iotaBeeHome/$iotaBeeConfig.json

# SET NEW PEERS
if [ "$parserIotaBeeId1" != "$iotaBeePeerId1" ] && [ ! -z "$iotaBeePeer1" ]; then
    sudo jq '.network.peering.peers [0] |= . + { "address": "'$iotaBeePeer1'", "alias": "'$iotaBeePeerAlias1'" }' $iotaBeeHome/$iotaBeeConfig.json|sponge $iotaBeeHome/$iotaBeeConfig.json
    restartIotaBee=true
fi
if [ "$parserIotaBeeId2" != "$iotaBeePeerId2" ] && [ ! -z "$iotaBeePeer2" ]; then
    sudo jq '.network.peering.peers [1] |= . + { "address": "'$iotaBeePeer2'", "alias": "'$iotaBeePeerAlias2'" }' $iotaBeeHome/$iotaBeeConfig.json|sponge $iotaBeeHome/$iotaBeeConfig.json
    restartIotaBee=true
fi
if [ "$parserIotaBeeId3" != "$iotaBeePeerId3" ] && [ ! -z "$iotaBeePeer3" ]; then
    sudo jq '.network.peering.peers [2] |= . + { "address": "'$iotaBeePeer3'", "alias": "'$iotaBeePeerAlias3'" }' $iotaBeeHome/$iotaBeeConfig.json|sponge $iotaBeeHome/$iotaBeeConfig.json
    restartIotaBee=true
fi
if [ "$parserIotaBeeId4" != "$iotaBeePeerId4" ] && [ ! -z "$iotaBeePeer4" ]; then
    sudo jq '.network.peering.peers [3] |= . + { "address": "'$iotaBeePeer4'", "alias": "'$iotaBeePeerAlias4'" }' $iotaBeeHome/$iotaBeeConfig.json|sponge $iotaBeeHome/$iotaBeeConfig.json
    restartIotaBee=true
fi
if [ "$parserIotaBeeId5" != "$iotaBeePeerId5" ] && [ ! -z "$iotaBeePeer5" ]; then
    sudo jq '.network.peering.peers [4] |= . + { "address": "'$iotaBeePeer5'", "alias": "'$iotaBeePeerAlias5'" }' $iotaBeeHome/$iotaBeeConfig.json|sponge $iotaBeeHome/$iotaBeeConfig.json
    restartIotaBee=true
fi
if [ "$parserIotaBeeId6" != "$iotaBeePeerId6" ] && [ ! -z "$iotaBeePeer6" ]; then
    sudo jq '.network.peering.peers [5] |= . + { "address": "'$iotaBeePeer6'", "alias": "'$iotaBeePeerAlias6'" }' $iotaBeeHome/$iotaBeeConfig.json|sponge $iotaBeeHome/$iotaBeeConfig.json
    restartIotaBee=true
fi
# DELETE NULL
sudo sed -i '/null,/d' $iotaBeeHome/$iotaBeeConfig.json
sudo sed -i '/null/d' $iotaBeeHome/$iotaBeeConfig.json
# UNSET VARS
unset parserIotaBeeId1 parserIotaBeeId2 parserIotaBeeId3 parserIotaBeeId4 parserIotaBeeId5 parserIotaBeeId6 iotaBeePeerId1 iotaBeePeerId2 iotaBeePeerId3 iotaBeePeerId4 iotaBeePeerId5 iotaBeePeerId6
