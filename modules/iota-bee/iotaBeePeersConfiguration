#!/bin/bash

while [ $exitCode -lt 1 ]; do
    clear
    source $swarmConfigs/bee.cfg
    # BEE Peers
    CHOICE=$(
        whiptail --title "Bee [IOTA] Peers" --menu "\nChoose an option" 24 65 0 \
        "1)" "Peers Info" \
        "2)" "Peer 1 [$iotaBeePeerAlias1]" \
        "3)" "Peer 2 [$iotaBeePeerAlias2]" \
        "4)" "Peer 3 [$iotaBeePeerAlias3]" \
        "5)" "Peer 4 [$iotaBeePeerAlias4]" \
        "6)" "Peer 5 [$iotaBeePeerAlias5]" \
        "7)" "Peer 6 [$iotaBeePeerAlias6]" 3>&2 2>&1 1>&3
    )
    exitstatus=$?
    if [ "$exitstatus" = "1" ]; then
        exitCode=1
    fi
    case $CHOICE in
        "1)")
            whiptail --title "Bee [IOTA] Peers" --msgbox "\nPeer1: $iotaBeePeerAlias1\n\"$iotaBeePeer1\"\n\nPeer2: $iotaBeePeerAlias2\n\"$iotaBeePeer2\"\n\nPeer3: $iotaBeePeerAlias3\n\"$iotaBeePeer3\"\n\nPeer4: $iotaBeePeerAlias4\n\"$iotaBeePeer4\"\n\nPeer5: $iotaBeePeerAlias5\n\"$iotaBeePeer5\"\n\nPeer6: $iotaBeePeerAlias6\n\"$iotaBeePeer6\"" 30 68
        ;;
        "2)")
            while [ $exitCode -lt 1 ]; do
                iotaBeePeerNumber=1
                currentIotaBeePeer="$iotaBeePeer1"
                CHOICE=$(
                    whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$iotaBeePeerNumber address" \
                    "2)" "Edit Peer$iotaBeePeerNumber alias" \
                    "3)" "Delete Peer$iotaBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        iotaBeePeerAddress=$(echo $currentIotaBeePeer | cut -c 6- | cut -f1 -d "/")
                        iotaBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerAddress --title "Bee [IOTA] Peer$iotaBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$iotaBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $iotaBeePeerAddress =~ .*:.* ]]; then
                                iotaBeePeerNetProto="ip6"
                            else
                                iotaBeePeerIp4=$(echo $iotaBeePeerAddress | tr -d '.')
                                if [ $iotaBeePeerIp4 -eq $iotaBeePeerIp4 ] 2>/dev/null; then
                                    iotaBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$iotaBeePeerAddress" >/dev/null 2>&1;then
                                        iotaBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$iotaBeePeerNetProto" = "dns" ] || [ "$iotaBeePeerNetProto" = "ip4" ] || [ "$iotaBeePeerNetProto" = "ip6" ]; then
                                iotaBeePeerPort=$(echo $currentIotaBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                iotaBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerPort --title "Bee [IOTA] Peer$iotaBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$iotaBeePeerPort" ] && [ $iotaBeePeerPort -eq $iotaBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    iotaBeePeerId=$(echo $currentIotaBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    iotaBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerId --title "Bee [IOTA] Peer$iotaBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$iotaBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        iotaBeePeer="/$iotaBeePeerNetProto/$iotaBeePeerAddress/tcp/$iotaBeePeerPort/p2p/$iotaBeePeerId"
                                        if [ "$currentIotaBeePeer" != "$iotaBeePeer" ]; then
                                            sudo sed -i 's~^iotaBeePeer'$iotaBeePeerNumber'=.*~iotaBeePeer'$iotaBeePeerNumber'="'$iotaBeePeer'"~g' $swarmConfigs/bee.cfg
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "Changes applied to peer $iotaBeePeerNumber." 8 65
                                            restartIotaBee=true
                                        else
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No changes applied for peer $iotaBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No valid address for peer $iotaBeePeerNumber." 8 65
                            fi
                        fi
                        unset iotaBeePeerNumber
                        unset currentIotaBeePeer
                        unset iotaBeePeerAddress
                        unset iotaBeePeerNetProto
                        unset iotaBeePeerPort
                        unset iotaBeePeerId
                    ;;
                    "2)")
                        currentIotaBeePeerAlias="$iotaBeePeerAlias1"
                        iotaBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $currentIotaBeePeerAlias --title "Bee [IOTA] Peer $iotaBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentIotaBeePeerAlias" != "$iotaBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's~^iotaBeePeerAlias'$iotaBeePeerNumber'=.*~iotaBeePeerAlias'$iotaBeePeerNumber'="'"$iotaBeePeerAlias"'"~' $swarmConfigs/iota-bee.cfg
                            restartIotaBee=true
                        fi
                        unset currentIotaBeePeerAlias
                        unset iotaBeePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $iotaBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^iotaBeePeer'$iotaBeePeerNumber'=.*/iotaBeePeer'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            sudo sed -i 's/^iotaBeePeerAlias'$iotaBeePeerNumber'=.*/iotaBeePeerAlias'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            restartIotaBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "3)")
            while [ $exitCode -lt 1 ]; do
                iotaBeePeerNumber=2
                currentIotaBeePeer="$iotaBeePeer2"
                CHOICE=$(
                    whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$iotaBeePeerNumber address" \
                    "2)" "Edit Peer$iotaBeePeerNumber alias" \
                    "3)" "Delete Peer$iotaBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        iotaBeePeerAddress=$(echo $currentIotaBeePeer | cut -c 6- | cut -f1 -d "/")
                        iotaBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerAddress --title "Bee [IOTA] Peer$iotaBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$iotaBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $iotaBeePeerAddress =~ .*:.* ]]; then
                                iotaBeePeerNetProto="ip6"
                            else
                                iotaBeePeerIp4=$(echo $iotaBeePeerAddress | tr -d '.')
                                if [ $iotaBeePeerIp4 -eq $iotaBeePeerIp4 ] 2>/dev/null; then
                                    iotaBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$iotaBeePeerAddress" >/dev/null 2>&1;then
                                        iotaBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$iotaBeePeerNetProto" = "dns" ] || [ "$iotaBeePeerNetProto" = "ip4" ] || [ "$iotaBeePeerNetProto" = "ip6" ]; then
                                iotaBeePeerPort=$(echo $currentIotaBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                iotaBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerPort --title "Bee [IOTA] Peer$iotaBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$iotaBeePeerPort" ] && [ $iotaBeePeerPort -eq $iotaBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    iotaBeePeerId=$(echo $currentIotaBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    iotaBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerId --title "Bee [IOTA] Peer$iotaBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$iotaBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        iotaBeePeer="/$iotaBeePeerNetProto/$iotaBeePeerAddress/tcp/$iotaBeePeerPort/p2p/$iotaBeePeerId"
                                        if [ "$currentIotaBeePeer" != "$iotaBeePeer" ]; then
                                            sudo sed -i 's~^iotaBeePeer'$iotaBeePeerNumber'=.*~iotaBeePeer'$iotaBeePeerNumber'="'$iotaBeePeer'"~g' $swarmConfigs/bee.cfg
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "Changes applied to peer $iotaBeePeerNumber." 8 65
                                            restartIotaBee=true
                                        else
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No changes applied for peer $iotaBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No valid address for peer $iotaBeePeerNumber." 8 65
                            fi
                        fi
                        unset iotaBeePeerNumber
                        unset currentIotaBeePeer
                        unset iotaBeePeerAddress
                        unset iotaBeePeerNetProto
                        unset iotaBeePeerPort
                        unset iotaBeePeerId
                    ;;
                    "2)")
                        currentIotaBeePeerAlias="$iotaBeePeerAlias2"
                        iotaBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $currentIotaBeePeerAlias --title "Bee [IOTA] Peer $iotaBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentIotaBeePeerAlias" != "$iotaBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's~^iotaBeePeerAlias'$iotaBeePeerNumber'=.*~iotaBeePeerAlias'$iotaBeePeerNumber'="'"$iotaBeePeerAlias"'"~' $swarmConfigs/iota-bee.cfg
                            restartIotaBee=true
                        fi
                        unset currentIotaBeePeerAlias
                        unset iotaBeePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $iotaBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^iotaBeePeer'$iotaBeePeerNumber'=.*/iotaBeePeer'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            sudo sed -i 's/^iotaBeePeerAlias'$iotaBeePeerNumber'=.*/iotaBeePeerAlias'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            restartIotaBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "4)")
            while [ $exitCode -lt 1 ]; do
                iotaBeePeerNumber=3
                currentIotaBeePeer="$iotaBeePeer3"
                CHOICE=$(
                    whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$iotaBeePeerNumber address" \
                    "2)" "Edit Peer$iotaBeePeerNumber alias" \
                    "3)" "Delete Peer$iotaBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        iotaBeePeerAddress=$(echo $currentIotaBeePeer | cut -c 6- | cut -f1 -d "/")
                        iotaBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerAddress --title "Bee [IOTA] Peer$iotaBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$iotaBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $iotaBeePeerAddress =~ .*:.* ]]; then
                                iotaBeePeerNetProto="ip6"
                            else
                                iotaBeePeerIp4=$(echo $iotaBeePeerAddress | tr -d '.')
                                if [ $iotaBeePeerIp4 -eq $iotaBeePeerIp4 ] 2>/dev/null; then
                                    iotaBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$iotaBeePeerAddress" >/dev/null 2>&1;then
                                        iotaBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$iotaBeePeerNetProto" = "dns" ] || [ "$iotaBeePeerNetProto" = "ip4" ] || [ "$iotaBeePeerNetProto" = "ip6" ]; then
                                iotaBeePeerPort=$(echo $currentIotaBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                iotaBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerPort --title "Bee [IOTA] Peer$iotaBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$iotaBeePeerPort" ] && [ $iotaBeePeerPort -eq $iotaBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    iotaBeePeerId=$(echo $currentIotaBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    iotaBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerId --title "Bee [IOTA] Peer$iotaBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$iotaBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        iotaBeePeer="/$iotaBeePeerNetProto/$iotaBeePeerAddress/tcp/$iotaBeePeerPort/p2p/$iotaBeePeerId"
                                        if [ "$currentIotaBeePeer" != "$iotaBeePeer" ]; then
                                            sudo sed -i 's~^iotaBeePeer'$iotaBeePeerNumber'=.*~iotaBeePeer'$iotaBeePeerNumber'="'$iotaBeePeer'"~g' $swarmConfigs/bee.cfg
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "Changes applied to peer $iotaBeePeerNumber." 8 65
                                            restartIotaBee=true
                                        else
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No changes applied for peer $iotaBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No valid address for peer $iotaBeePeerNumber." 8 65
                            fi
                        fi
                        unset iotaBeePeerNumber
                        unset currentIotaBeePeer
                        unset iotaBeePeerAddress
                        unset iotaBeePeerNetProto
                        unset iotaBeePeerPort
                        unset iotaBeePeerId
                    ;;
                    "2)")
                        currentIotaBeePeerAlias="$iotaBeePeerAlias3"
                        iotaBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $currentIotaBeePeerAlias --title "Bee [IOTA] Peer $iotaBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentIotaBeePeerAlias" != "$iotaBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's~^iotaBeePeerAlias'$iotaBeePeerNumber'=.*~iotaBeePeerAlias'$iotaBeePeerNumber'="'"$iotaBeePeerAlias"'"~' $swarmConfigs/iota-bee.cfg
                            restartIotaBee=true
                        fi
                        unset currentIotaBeePeerAlias
                        unset iotaBeePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $iotaBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^iotaBeePeer'$iotaBeePeerNumber'=.*/iotaBeePeer'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            sudo sed -i 's/^iotaBeePeerAlias'$iotaBeePeerNumber'=.*/iotaBeePeerAlias'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            restartIotaBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "5)")
            while [ $exitCode -lt 1 ]; do
                iotaBeePeerNumber=4
                currentIotaBeePeer="$iotaBeePeer4"
                CHOICE=$(
                    whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$iotaBeePeerNumber address" \
                    "2)" "Edit Peer$iotaBeePeerNumber alias" \
                    "3)" "Delete Peer$iotaBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        iotaBeePeerAddress=$(echo $currentIotaBeePeer | cut -c 6- | cut -f1 -d "/")
                        iotaBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerAddress --title "Bee [IOTA] Peer$iotaBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$iotaBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $iotaBeePeerAddress =~ .*:.* ]]; then
                                iotaBeePeerNetProto="ip6"
                            else
                                iotaBeePeerIp4=$(echo $iotaBeePeerAddress | tr -d '.')
                                if [ $iotaBeePeerIp4 -eq $iotaBeePeerIp4 ] 2>/dev/null; then
                                    iotaBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$iotaBeePeerAddress" >/dev/null 2>&1;then
                                        iotaBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$iotaBeePeerNetProto" = "dns" ] || [ "$iotaBeePeerNetProto" = "ip4" ] || [ "$iotaBeePeerNetProto" = "ip6" ]; then
                                iotaBeePeerPort=$(echo $currentIotaBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                iotaBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerPort --title "Bee [IOTA] Peer$iotaBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$iotaBeePeerPort" ] && [ $iotaBeePeerPort -eq $iotaBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    iotaBeePeerId=$(echo $currentIotaBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    iotaBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerId --title "Bee [IOTA] Peer$iotaBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$iotaBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        iotaBeePeer="/$iotaBeePeerNetProto/$iotaBeePeerAddress/tcp/$iotaBeePeerPort/p2p/$iotaBeePeerId"
                                        if [ "$currentIotaBeePeer" != "$iotaBeePeer" ]; then
                                            sudo sed -i 's~^iotaBeePeer'$iotaBeePeerNumber'=.*~iotaBeePeer'$iotaBeePeerNumber'="'$iotaBeePeer'"~g' $swarmConfigs/bee.cfg
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "Changes applied to peer $iotaBeePeerNumber." 8 65
                                            restartIotaBee=true
                                        else
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No changes applied for peer $iotaBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No valid address for peer $iotaBeePeerNumber." 8 65
                            fi
                        fi
                        unset iotaBeePeerNumber
                        unset currentIotaBeePeer
                        unset iotaBeePeerAddress
                        unset iotaBeePeerNetProto
                        unset iotaBeePeerPort
                        unset iotaBeePeerId
                    ;;
                    "2)")
                        currentIotaBeePeerAlias="$iotaBeePeerAlias4"
                        iotaBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $currentIotaBeePeerAlias --title "Bee [IOTA] Peer $iotaBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentIotaBeePeerAlias" != "$iotaBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's~^iotaBeePeerAlias'$iotaBeePeerNumber'=.*~iotaBeePeerAlias'$iotaBeePeerNumber'="'"$iotaBeePeerAlias"'"~' $swarmConfigs/iota-bee.cfg
                            restartIotaBee=true
                        fi
                        unset currentIotaBeePeerAlias
                        unset iotaBeePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $iotaBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^iotaBeePeer'$iotaBeePeerNumber'=.*/iotaBeePeer'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            sudo sed -i 's/^iotaBeePeerAlias'$iotaBeePeerNumber'=.*/iotaBeePeerAlias'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            restartIotaBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "6)")
            while [ $exitCode -lt 1 ]; do
                iotaBeePeerNumber=5
                currentIotaBeePeer="$iotaBeePeer5"
                CHOICE=$(
                    whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$iotaBeePeerNumber address" \
                    "2)" "Edit Peer$iotaBeePeerNumber alias" \
                    "3)" "Delete Peer$iotaBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        iotaBeePeerAddress=$(echo $currentIotaBeePeer | cut -c 6- | cut -f1 -d "/")
                        iotaBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerAddress --title "Bee [IOTA] Peer$iotaBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$iotaBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $iotaBeePeerAddress =~ .*:.* ]]; then
                                iotaBeePeerNetProto="ip6"
                            else
                                iotaBeePeerIp4=$(echo $iotaBeePeerAddress | tr -d '.')
                                if [ $iotaBeePeerIp4 -eq $iotaBeePeerIp4 ] 2>/dev/null; then
                                    iotaBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$iotaBeePeerAddress" >/dev/null 2>&1;then
                                        iotaBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$iotaBeePeerNetProto" = "dns" ] || [ "$iotaBeePeerNetProto" = "ip4" ] || [ "$iotaBeePeerNetProto" = "ip6" ]; then
                                iotaBeePeerPort=$(echo $currentIotaBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                iotaBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerPort --title "Bee [IOTA] Peer$iotaBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$iotaBeePeerPort" ] && [ $iotaBeePeerPort -eq $iotaBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    iotaBeePeerId=$(echo $currentIotaBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    iotaBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerId --title "Bee [IOTA] Peer$iotaBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$iotaBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        iotaBeePeer="/$iotaBeePeerNetProto/$iotaBeePeerAddress/tcp/$iotaBeePeerPort/p2p/$iotaBeePeerId"
                                        if [ "$currentIotaBeePeer" != "$iotaBeePeer" ]; then
                                            sudo sed -i 's~^iotaBeePeer'$iotaBeePeerNumber'=.*~iotaBeePeer'$iotaBeePeerNumber'="'$iotaBeePeer'"~g' $swarmConfigs/bee.cfg
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "Changes applied to peer $iotaBeePeerNumber." 8 65
                                            restartIotaBee=true
                                        else
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No changes applied for peer $iotaBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No valid address for peer $iotaBeePeerNumber." 8 65
                            fi
                        fi
                        unset iotaBeePeerNumber
                        unset currentIotaBeePeer
                        unset iotaBeePeerAddress
                        unset iotaBeePeerNetProto
                        unset iotaBeePeerPort
                        unset iotaBeePeerId
                    ;;
                    "2)")
                        currentIotaBeePeerAlias="$iotaBeePeerAlias5"
                        iotaBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $currentIotaBeePeerAlias --title "Bee [IOTA] Peer $iotaBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentIotaBeePeerAlias" != "$iotaBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's~^iotaBeePeerAlias'$iotaBeePeerNumber'=.*~iotaBeePeerAlias'$iotaBeePeerNumber'="'"$iotaBeePeerAlias"'"~' $swarmConfigs/iota-bee.cfg
                            restartIotaBee=true
                        fi
                        unset currentIotaBeePeerAlias
                        unset iotaBeePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $iotaBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^iotaBeePeer'$iotaBeePeerNumber'=.*/iotaBeePeer'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            sudo sed -i 's/^iotaBeePeerAlias'$iotaBeePeerNumber'=.*/iotaBeePeerAlias'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            restartIotaBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "7)")
            while [ $exitCode -lt 1 ]; do
                iotaBeePeerNumber=6
                currentIotaBeePeer="$iotaBeePeer6"
                CHOICE=$(
                    whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$iotaBeePeerNumber address" \
                    "2)" "Edit Peer$iotaBeePeerNumber alias" \
                    "3)" "Delete Peer$iotaBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        iotaBeePeerAddress=$(echo $currentIotaBeePeer | cut -c 6- | cut -f1 -d "/")
                        iotaBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerAddress --title "Bee [IOTA] Peer$iotaBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$iotaBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $iotaBeePeerAddress =~ .*:.* ]]; then
                                iotaBeePeerNetProto="ip6"
                            else
                                iotaBeePeerIp4=$(echo $iotaBeePeerAddress | tr -d '.')
                                if [ $iotaBeePeerIp4 -eq $iotaBeePeerIp4 ] 2>/dev/null; then
                                    iotaBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$iotaBeePeerAddress" >/dev/null 2>&1;then
                                        iotaBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$iotaBeePeerNetProto" = "dns" ] || [ "$iotaBeePeerNetProto" = "ip4" ] || [ "$iotaBeePeerNetProto" = "ip6" ]; then
                                iotaBeePeerPort=$(echo $currentIotaBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                iotaBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerPort --title "Bee [IOTA] Peer$iotaBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$iotaBeePeerPort" ] && [ $iotaBeePeerPort -eq $iotaBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    iotaBeePeerId=$(echo $currentIotaBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    iotaBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $iotaBeePeerId --title "Bee [IOTA] Peer$iotaBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$iotaBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        iotaBeePeer="/$iotaBeePeerNetProto/$iotaBeePeerAddress/tcp/$iotaBeePeerPort/p2p/$iotaBeePeerId"
                                        if [ "$currentIotaBeePeer" != "$iotaBeePeer" ]; then
                                            sudo sed -i 's~^iotaBeePeer'$iotaBeePeerNumber'=.*~iotaBeePeer'$iotaBeePeerNumber'="'$iotaBeePeer'"~g' $swarmConfigs/bee.cfg
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "Changes applied to peer $iotaBeePeerNumber." 8 65
                                            restartIotaBee=true
                                        else
                                            whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No changes applied for peer $iotaBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --msgbox "No valid address for peer $iotaBeePeerNumber." 8 65
                            fi
                        fi
                        unset iotaBeePeerNumber
                        unset currentIotaBeePeer
                        unset iotaBeePeerAddress
                        unset iotaBeePeerNetProto
                        unset iotaBeePeerPort
                        unset iotaBeePeerId
                    ;;
                    "2)")
                        currentIotaBeePeerAlias="$iotaBeePeerAlias6"
                        iotaBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $iotaBeePeerNumber\" or select cancel" 10 65 $currentIotaBeePeerAlias --title "Bee [IOTA] Peer $iotaBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentIotaBeePeerAlias" != "$iotaBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's~^iotaBeePeerAlias'$iotaBeePeerNumber'=.*~iotaBeePeerAlias'$iotaBeePeerNumber'="'"$iotaBeePeerAlias"'"~' $swarmConfigs/iota-bee.cfg
                            restartIotaBee=true
                        fi
                        unset currentIotaBeePeerAlias
                        unset iotaBeePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Bee [IOTA] Peer $iotaBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $iotaBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^iotaBeePeer'$iotaBeePeerNumber'=.*/iotaBeePeer'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            sudo sed -i 's/^iotaBeePeerAlias'$iotaBeePeerNumber'=.*/iotaBeePeerAlias'$iotaBeePeerNumber'=""/' $swarmConfigs/bee.cfg
                            restartIotaBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
    esac
done
exitCode=0