#!/bin/bash

IFS=', ' read -r -a ARRAYbeeApiPublicRoutes <<< "$beeApiPublicRoutes"
validateBeeApiPublicRoutes=$(echo "${beeApiPublicRoutes: -1}")
if [ "$validateBeeApiPublicRoutes" = "," ]; then
    beeApiPublicRoutes="${beeApiPublicRoutes%?}"
    sudo sed -i 's~^beeApiPublicRoutes=.*~beeApiPublicRoutes="'$beeApiPublicRoutes'"~' $swarmConfigs/bee.cfg
    beeForceApiPublicRoutes=true
    echo "beeApiPublicRoutes" >> /tmp/beeParsing
fi

parser="$(jq '.restApi.publicRoutes' $beeHome/$beeConfig.json)"
parser="$(echo $parser | tr -d '[]" ')"


if [ "$parser" != "$beeApiPublicRoutes" ] || [ "$beeForceApiPublicRoutes" = "true" ]; then
    sudo jq '.restApi.publicRoutes |= []' $beeHome/$beeConfig.json|sponge $beeHome/$beeConfig.json
    for beeApiPublicRoute in "${ARRAYbeeApiPublicRoutes[@]}"
    do
        sudo jq '.restApi.publicRoutes |= .+ ["'$beeApiPublicRoute'"]' $beeHome/$beeConfig.json|sponge $beeHome/$beeConfig.json
    done
    restartBee=true
    echo "beeApiPublicRoutes2" >> /tmp/beeParsing
fi

if [ -z "$parser" ]; then
    echo "Empty parsing beeApiPublicRoutes" >> /tmp/beeParsing
fi

unset ARRAYbeeApiPublicRoutes beeApiPublicRoute beeForceApiPublicRoutes
