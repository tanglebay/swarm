#!/bin/bash

while [ $exitCode -lt 1 ]; do
    clear
    source $swarmConfigs/shimmer-bee.cfg
    # BEE Peers
    CHOICE=$(
        whiptail --title "Shimmer-Bee - Peers" --menu "\nChoose an option" 20 65 0 \
        "1)" "Peers Info" \
        "2)" "Peer 1 [$shimmerBeePeerAlias1]" \
        "3)" "Peer 2 [$shimmerBeePeerAlias2]" \
        "4)" "Peer 3 [$shimmerBeePeerAlias3]" \
        "5)" "Peer 4 [$shimmerBeePeerAlias4]" \
        "6)" "Peer 5 [$shimmerBeePeerAlias5]" \
        "7)" "Peer 6 [$shimmerBeePeerAlias6]" 3>&2 2>&1 1>&3
    )
    exitstatus=$?
    if [ "$exitstatus" = "1" ]; then
        exitCode=1
    fi
    case $CHOICE in
        "1)")
            whiptail --title "Shimmer-Bee - Peers" --msgbox "\nPeer1: $shimmerBeePeerAlias1\n\"$shimmerBeePeer1\"\n\nPeer2: $shimmerBeePeerAlias2\n\"$shimmerBeePeer2\"\n\nPeer3: $shimmerBeePeerAlias3\n\"$shimmerBeePeer3\"\n\nPeer4: $shimmerBeePeerAlias4\n\"$shimmerBeePeer4\"\n\nPeer5: $shimmerBeePeerAlias5\n\"$shimmerBeePeer5\"\n\nPeer6: $shimmerBeePeerAlias6\n\"$shimmerBeePeer6\"" 30 68
        ;;
        "2)")
            while [ $exitCode -lt 1 ]; do
                shimmerBeePeerNumber=1
                currentShimmerBeePeer="$shimmerBeePeer1"
                CHOICE=$(
                    whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$shimmerBeePeerNumber address" \
                    "2)" "Edit Peer$shimmerBeePeerNumber alias" \
                    "3)" "Delete Peer$shimmerBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        shimmerBeePeerAddress=$(echo $currentShimmerBeePeer | cut -c 6- | cut -f1 -d "/")
                        shimmerBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerAddress --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$shimmerBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $shimmerBeePeerAddress =~ .*:.* ]]; then
                                shimmerBeePeerNetProto="ip6"
                            else
                                shimmerBeePeerIp4=$(echo $shimmerBeePeerAddress | tr -d '.')
                                if [ $shimmerBeePeerIp4 -eq $shimmerBeePeerIp4 ] 2>/dev/null; then
                                    shimmerBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$shimmerBeePeerAddress" >/dev/null 2>&1;then
                                        shimmerBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$shimmerBeePeerNetProto" = "dns" ] || [ "$shimmerBeePeerNetProto" = "ip4" ] || [ "$shimmerBeePeerNetProto" = "ip6" ]; then
                                shimmerBeePeerPort=$(echo $currentShimmerBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                shimmerBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerPort --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$shimmerBeePeerPort" ] && [ $shimmerBeePeerPort -eq $shimmerBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    shimmerBeePeerId=$(echo $currentShimmerBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    shimmerBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerId --title "Shimmer-Bee - Peer$shimmerBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$shimmerBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        shimmerBeePeer="/$shimmerBeePeerNetProto/$shimmerBeePeerAddress/tcp/$shimmerBeePeerPort/p2p/$shimmerBeePeerId"
                                        if [ "$currentShimmerBeePeer" != "$shimmerBeePeer" ]; then
                                            sudo sed -i 's~^shimmerBeePeer'$shimmerBeePeerNumber'=.*~shimmerBeePeer'$shimmerBeePeerNumber'="'$shimmerBeePeer'"~g' $swarmConfigs/shimmer-bee.cfg
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "Changes applied to peer $shimmerBeePeerNumber." 8 65
                                            restartShimmerBee=true
                                        else
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "No changes applied for peer $shimmerBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "No valid address for peer $shimmerBeePeerNumber." 8 65
                            fi
                        fi
                        unset shimmerBeePeerNumber currentShimmerBeePeer shimmerBeePeerAddress shimmerBeePeerNetProto shimmerBeePeerPort shimmerBeePeerId
                    ;;
                    "2)")
                        currentShimmerBeePeerAlias="$shimmerBeePeerAlias1"
                        shimmerBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $currentShimmerBeePeerAlias --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentShimmerBeePeerAlias" != "$shimmerBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'="'$shimmerBeePeerAlias'"/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                        unset currentShimmerBeePeerAlias shimmerBeePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $shimmerBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^shimmerBeePeer'$shimmerBeePeerNumber'=.*/shimmerBeePeer'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "3)")
            while [ $exitCode -lt 1 ]; do
                shimmerBeePeerNumber=2
                currentShimmerBeePeer="$shimmerBeePeer2"
                CHOICE=$(
                    whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$shimmerBeePeerNumber address" \
                    "2)" "Edit Peer$shimmerBeePeerNumber alias" \
                    "3)" "Delete Peer$shimmerBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        shimmerBeePeerAddress=$(echo $currentShimmerBeePeer | cut -c 6- | cut -f1 -d "/")
                        shimmerBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerAddress --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$shimmerBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $shimmerBeePeerAddress =~ .*:.* ]]; then
                                shimmerBeePeerNetProto="ip6"
                            else
                                shimmerBeePeerIp4=$(echo $shimmerBeePeerAddress | tr -d '.')
                                if [ $shimmerBeePeerIp4 -eq $shimmerBeePeerIp4 ] 2>/dev/null; then
                                    shimmerBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$shimmerBeePeerAddress" >/dev/null 2>&1;then
                                        shimmerBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$shimmerBeePeerNetProto" = "dns" ] || [ "$shimmerBeePeerNetProto" = "ip4" ] || [ "$shimmerBeePeerNetProto" = "ip6" ]; then
                                shimmerBeePeerPort=$(echo $currentShimmerBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                shimmerBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerPort --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$shimmerBeePeerPort" ] && [ $shimmerBeePeerPort -eq $shimmerBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    shimmerBeePeerId=$(echo $currentShimmerBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    shimmerBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerId --title "Shimmer-Bee - Peer$shimmerBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$shimmerBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        shimmerBeePeer="/$shimmerBeePeerNetProto/$shimmerBeePeerAddress/tcp/$shimmerBeePeerPort/p2p/$shimmerBeePeerId"
                                        if [ "$currentShimmerBeePeer" != "$shimmerBeePeer" ]; then
                                            sudo sed -i 's~^shimmerBeePeer'$shimmerBeePeerNumber'=.*~shimmerBeePeer'$shimmerBeePeerNumber'="'$shimmerBeePeer'"~g' $swarmConfigs/shimmer-bee.cfg
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "Changes applied to peer $shimmerBeePeerNumber." 8 65
                                            restartShimmerBee=true
                                        else
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "No changes applied for peer $shimmerBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee - Peer $shimmerBeePeerNumber" --msgbox "No valid address for peer $shimmerBeePeerNumber." 8 65
                            fi
                        fi
                        unset shimmerBeePeerNumber currentShimmerBeePeer shimmerBeePeerAddress shimmerBeePeerNetProto shimmerBeePeerPort shimmerBeePeerId
                    ;;
                    "2)")
                        currentShimmerBeePeerAlias="$shimmerBeePeerAlias2"
                        shimmerBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $currentShimmerBeePeerAlias --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentShimmerBeePeerAlias" != "$shimmerBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'="'$shimmerBeePeerAlias'"/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                        unset currentBeePeerAlias beePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $shimmerBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^shimmerBeePeer'$shimmerBeePeerNumber'=.*/shimmerBeePeer'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "4)")
            while [ $exitCode -lt 1 ]; do
                shimmerBeePeerNumber=3
                currentShimmerBeePeer="$shimmerBeePeer3"
                CHOICE=$(
                    whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$shimmerBeePeerNumber address" \
                    "2)" "Edit Peer$shimmerBeePeerNumber alias" \
                    "3)" "Delete Peer$shimmerBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        shimmerBeePeerAddress=$(echo $currentShimmerBeePeer | cut -c 6- | cut -f1 -d "/")
                        shimmerBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerAddress --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$shimmerBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $shimmerBeePeerAddress =~ .*:.* ]]; then
                                shimmerBeePeerNetProto="ip6"
                            else
                                shimmerBeePeerIp4=$(echo $shimmerBeePeerAddress | tr -d '.')
                                if [ $shimmerBeePeerIp4 -eq $shimmerBeePeerIp4 ] 2>/dev/null; then
                                    shimmerBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$shimmerBeePeerAddress" >/dev/null 2>&1;then
                                        shimmerBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$shimmerBeePeerNetProto" = "dns" ] || [ "$shimmerBeePeerNetProto" = "ip4" ] || [ "$shimmerBeePeerNetProto" = "ip6" ]; then
                                shimmerBeePeerPort=$(echo $currentShimmerBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                shimmerBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerPort --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$shimmerBeePeerPort" ] && [ $shimmerBeePeerPort -eq $shimmerBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    shimmerBeePeerId=$(echo $currentShimmerBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    shimmerBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerId --title "Shimmer-Bee - Peer$shimmerBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$shimmerBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        shimmerBeePeer="/$shimmerBeePeerNetProto/$shimmerBeePeerAddress/tcp/$shimmerBeePeerPort/p2p/$shimmerBeePeerId"
                                        if [ "$currentShimmerBeePeer" != "$shimmerBeePeer" ]; then
                                            sudo sed -i 's~^shimmerBeePeer'$shimmerBeePeerNumber'=.*~shimmerBeePeer'$shimmerBeePeerNumber'="'$shimmerBeePeer'"~g' $swarmConfigs/shimmer-bee.cfg
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "Changes applied to peer $shimmerBeePeerNumber." 8 65
                                            restartShimmerBee=true
                                        else
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "No changes applied for peer $shimmerBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee - Peer $shimmerBeePeerNumber" --msgbox "No valid address for peer $shimmerBeePeerNumber." 8 65
                            fi
                        fi
                        unset shimmerBeePeerNumber currentShimmerBeePeer shimmerBeePeerAddress shimmerBeePeerNetProto shimmerBeePeerPort shimmerBeePeerId
                    ;;
                    "2)")
                        currentShimmerBeePeerAlias="$shimmerBeePeerAlias2"
                        shimmerBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $currentShimmerBeePeerAlias --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentShimmerBeePeerAlias" != "$shimmerBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'="'$shimmerBeePeerAlias'"/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                        unset currentBeePeerAlias beePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $shimmerBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^shimmerBeePeer'$shimmerBeePeerNumber'=.*/shimmerBeePeer'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "5)")
            while [ $exitCode -lt 1 ]; do
                beePeerNumber=4
                currentBeePeer="$beePeer4"
                CHOICE=$(
                    whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$shimmerBeePeerNumber address" \
                    "2)" "Edit Peer$shimmerBeePeerNumber alias" \
                    "3)" "Delete Peer$shimmerBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        shimmerBeePeerAddress=$(echo $currentShimmerBeePeer | cut -c 6- | cut -f1 -d "/")
                        shimmerBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerAddress --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$shimmerBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $shimmerBeePeerAddress =~ .*:.* ]]; then
                                shimmerBeePeerNetProto="ip6"
                            else
                                shimmerBeePeerIp4=$(echo $shimmerBeePeerAddress | tr -d '.')
                                if [ $shimmerBeePeerIp4 -eq $shimmerBeePeerIp4 ] 2>/dev/null; then
                                    shimmerBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$shimmerBeePeerAddress" >/dev/null 2>&1;then
                                        shimmerBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$shimmerBeePeerNetProto" = "dns" ] || [ "$shimmerBeePeerNetProto" = "ip4" ] || [ "$shimmerBeePeerNetProto" = "ip6" ]; then
                                shimmerBeePeerPort=$(echo $currentShimmerBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                shimmerBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerPort --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$shimmerBeePeerPort" ] && [ $shimmerBeePeerPort -eq $shimmerBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    shimmerBeePeerId=$(echo $currentShimmerBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    shimmerBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerId --title "Shimmer-Bee - Peer$shimmerBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$shimmerBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        shimmerBeePeer="/$shimmerBeePeerNetProto/$shimmerBeePeerAddress/tcp/$shimmerBeePeerPort/p2p/$shimmerBeePeerId"
                                        if [ "$currentShimmerBeePeer" != "$shimmerBeePeer" ]; then
                                            sudo sed -i 's~^shimmerBeePeer'$shimmerBeePeerNumber'=.*~shimmerBeePeer'$shimmerBeePeerNumber'="'$shimmerBeePeer'"~g' $swarmConfigs/shimmer-bee.cfg
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "Changes applied to peer $shimmerBeePeerNumber." 8 65
                                            restartShimmerBee=true
                                        else
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "No changes applied for peer $shimmerBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee - Peer $shimmerBeePeerNumber" --msgbox "No valid address for peer $shimmerBeePeerNumber." 8 65
                            fi
                        fi
                        unset shimmerBeePeerNumber currentShimmerBeePeer shimmerBeePeerAddress shimmerBeePeerNetProto shimmerBeePeerPort shimmerBeePeerId
                    ;;
                    "2)")
                        currentShimmerBeePeerAlias="$shimmerBeePeerAlias2"
                        shimmerBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $currentShimmerBeePeerAlias --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentShimmerBeePeerAlias" != "$shimmerBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'="'$shimmerBeePeerAlias'"/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                        unset currentBeePeerAlias beePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $shimmerBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^shimmerBeePeer'$shimmerBeePeerNumber'=.*/shimmerBeePeer'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "6)")
            while [ $exitCode -lt 1 ]; do
                beePeerNumber=5
                currentBeePeer="$beePeer5"
                CHOICE=$(
                    whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$shimmerBeePeerNumber address" \
                    "2)" "Edit Peer$shimmerBeePeerNumber alias" \
                    "3)" "Delete Peer$shimmerBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        shimmerBeePeerAddress=$(echo $currentShimmerBeePeer | cut -c 6- | cut -f1 -d "/")
                        shimmerBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerAddress --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$shimmerBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $shimmerBeePeerAddress =~ .*:.* ]]; then
                                shimmerBeePeerNetProto="ip6"
                            else
                                shimmerBeePeerIp4=$(echo $shimmerBeePeerAddress | tr -d '.')
                                if [ $shimmerBeePeerIp4 -eq $shimmerBeePeerIp4 ] 2>/dev/null; then
                                    shimmerBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$shimmerBeePeerAddress" >/dev/null 2>&1;then
                                        shimmerBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$shimmerBeePeerNetProto" = "dns" ] || [ "$shimmerBeePeerNetProto" = "ip4" ] || [ "$shimmerBeePeerNetProto" = "ip6" ]; then
                                shimmerBeePeerPort=$(echo $currentShimmerBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                shimmerBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerPort --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$shimmerBeePeerPort" ] && [ $shimmerBeePeerPort -eq $shimmerBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    shimmerBeePeerId=$(echo $currentShimmerBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    shimmerBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerId --title "Shimmer-Bee - Peer$shimmerBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$shimmerBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        shimmerBeePeer="/$shimmerBeePeerNetProto/$shimmerBeePeerAddress/tcp/$shimmerBeePeerPort/p2p/$shimmerBeePeerId"
                                        if [ "$currentShimmerBeePeer" != "$shimmerBeePeer" ]; then
                                            sudo sed -i 's~^shimmerBeePeer'$shimmerBeePeerNumber'=.*~shimmerBeePeer'$shimmerBeePeerNumber'="'$shimmerBeePeer'"~g' $swarmConfigs/shimmer-bee.cfg
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "Changes applied to peer $shimmerBeePeerNumber." 8 65
                                            restartShimmerBee=true
                                        else
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "No changes applied for peer $shimmerBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee - Peer $shimmerBeePeerNumber" --msgbox "No valid address for peer $shimmerBeePeerNumber." 8 65
                            fi
                        fi
                        unset shimmerBeePeerNumber currentShimmerBeePeer shimmerBeePeerAddress shimmerBeePeerNetProto shimmerBeePeerPort shimmerBeePeerId
                    ;;
                    "2)")
                        currentShimmerBeePeerAlias="$shimmerBeePeerAlias2"
                        shimmerBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $currentShimmerBeePeerAlias --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentShimmerBeePeerAlias" != "$shimmerBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'="'$shimmerBeePeerAlias'"/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                        unset currentBeePeerAlias beePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $shimmerBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^shimmerBeePeer'$shimmerBeePeerNumber'=.*/shimmerBeePeer'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
        "7)")
            while [ $exitCode -lt 1 ]; do
                beePeerNumber=6
                currentBeePeer="$beePeer6"
                CHOICE=$(
                    whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --menu "\nChoose an option" 16 65 0 \
                    "1)" "Edit Peer$shimmerBeePeerNumber address" \
                    "2)" "Edit Peer$shimmerBeePeerNumber alias" \
                    "3)" "Delete Peer$shimmerBeePeerNumber" 3>&2 2>&1 1>&3
                )
                exitstatus=$?
                if [ "$exitstatus" = "1" ]; then
                    exitCode=1
                fi
                case $CHOICE in
                    "1)")
                        shimmerBeePeerAddress=$(echo $currentShimmerBeePeer | cut -c 6- | cut -f1 -d "/")
                        shimmerBeePeerAddress=$(whiptail --inputbox "\nPlease enter the domain or IPv4/IPv6 for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerAddress --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Address" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ ! -z "$shimmerBeePeerAddress" ] && [ "$exitStatus" != "1" ]; then
                            if [[ $shimmerBeePeerAddress =~ .*:.* ]]; then
                                shimmerBeePeerNetProto="ip6"
                            else
                                shimmerBeePeerIp4=$(echo $shimmerBeePeerAddress | tr -d '.')
                                if [ $shimmerBeePeerIp4 -eq $shimmerBeePeerIp4 ] 2>/dev/null; then
                                    shimmerBeePeerNetProto="ip4"
                                else
                                    if grep -oP '^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,6}$' <<< "$shimmerBeePeerAddress" >/dev/null 2>&1;then
                                        shimmerBeePeerNetProto="dns"
                                    fi
                                fi
                            fi
                            if [ "$shimmerBeePeerNetProto" = "dns" ] || [ "$shimmerBeePeerNetProto" = "ip4" ] || [ "$shimmerBeePeerNetProto" = "ip6" ]; then
                                shimmerBeePeerPort=$(echo $currentShimmerBeePeer | sed 's~^.*tcp~tcp~' | cut -c 5- | cut -f1 -d "/")
                                shimmerBeePeerPort=$(whiptail --inputbox "\nPlease enter the port for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerPort --title "Shimmer-Bee - Peer$shimmerBeePeerNumber Port" 3>&1 1>&2 2>&3)
                                exitStatus=$?
                                if [ ! -z "$shimmerBeePeerPort" ] && [ $shimmerBeePeerPort -eq $shimmerBeePeerPort ] && [ "$exitStatus" != "1" ] > /dev/null 2>&1; then
                                    shimmerBeePeerId=$(echo $currentShimmerBeePeer | sed 's~^.*p2p~p2p~' | cut -c 5- | cut -f1 -d "/")
                                    shimmerBeePeerId=$(whiptail --inputbox "\nPlease enter the ID for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $shimmerBeePeerId --title "Shimmer-Bee - Peer$shimmerBeePeerNumber ID" 3>&1 1>&2 2>&3)
                                    exitStatus=$?
                                    if [ ! -z "$shimmerBeePeerId" ] && [ "$exitStatus" != "1" ]; then
                                        shimmerBeePeer="/$shimmerBeePeerNetProto/$shimmerBeePeerAddress/tcp/$shimmerBeePeerPort/p2p/$shimmerBeePeerId"
                                        if [ "$currentShimmerBeePeer" != "$shimmerBeePeer" ]; then
                                            sudo sed -i 's~^shimmerBeePeer'$shimmerBeePeerNumber'=.*~shimmerBeePeer'$shimmerBeePeerNumber'="'$shimmerBeePeer'"~g' $swarmConfigs/shimmer-bee.cfg
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "Changes applied to peer $shimmerBeePeerNumber." 8 65
                                            restartShimmerBee=true
                                        else
                                            whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --msgbox "No changes applied for peer $shimmerBeePeerNumber." 8 65
                                        fi
                                    fi
                                fi
                            else
                                whiptail --title "Bee - Peer $shimmerBeePeerNumber" --msgbox "No valid address for peer $shimmerBeePeerNumber." 8 65
                            fi
                        fi
                        unset shimmerBeePeerNumber currentShimmerBeePeer shimmerBeePeerAddress shimmerBeePeerNetProto shimmerBeePeerPort shimmerBeePeerId
                    ;;
                    "2)")
                        currentShimmerBeePeerAlias="$shimmerBeePeerAlias2"
                        shimmerBeePeerAlias=$(whiptail --inputbox "\nPlease enter a alias for \"peer $shimmerBeePeerNumber\" or select cancel" 10 65 $currentShimmerBeePeerAlias --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" 3>&1 1>&2 2>&3)
                        exitStatus=$?
                        if [ "$currentShimmerBeePeerAlias" != "$shimmerBeePeerAlias" ] && [ "$exitStatus" != "1" ]; then
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'="'$shimmerBeePeerAlias'"/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                        unset currentBeePeerAlias beePeerAlias
                    ;;
                    "3)")
                        if (whiptail --title "Shimmer-Bee - Peer $shimmerBeePeerNumber" --yesno --defaultno "Are you sure you want to delete the peer $shimmerBeePeerNumber?" 8 65); then
                            sudo sed -i 's/^shimmerBeePeer'$shimmerBeePeerNumber'=.*/shimmerBeePeer'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            sudo sed -i 's/^shimmerBeePeerAlias'$shimmerBeePeerNumber'=.*/shimmerBeePeerAlias'$shimmerBeePeerNumber'=""/' $swarmConfigs/shimmer-bee.cfg
                            restartShimmerBee=true
                        fi
                    ;;
                esac
            done
            exitCode=0
        ;;
    esac
done
exitCode=0