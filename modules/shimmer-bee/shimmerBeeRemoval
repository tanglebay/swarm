#!/bin/bash

source $swarmConfigs/shimmer-bee.cfg
source $swarmConfigs/proxy.cfg
source $proxyModules/proxyParser

sudo systemctl stop shimmer-bee > /dev/null 2>&1

sudo systemctl disable shimmer-bee > /dev/null 2>&1

sudo rm -rf /usr/bin/shimmer-bee /var/lib/shimmer-bee /lib/systemd/system/shimmer-bee.service /etc/default/shimmer-bee > /dev/null 2>&1

sudo systemctl daemon-reload > /dev/null 2>&1

if [ "$ufw" = "true" ]; then
    sudo ufw delete allow $shimmerBeeGossipPort/tcp > /dev/null 2>&1
    sudo ufw delete allow $shimmerBeeAutopeeringPort/udp > /dev/null 2>&1
fi

sudo rm -rf $shimmerBeeHome > /dev/null 2>&1

if [ ! -f "/usr/bin/iota-bee" ] && [ ! -f "/usr/bin/shimmer-bee" ]; then
    if id bee > /dev/null 2>&1; then
        sudo deluser bee > /dev/null 2>&1
    fi
fi

if [ -f "/etc/nginx/sites-enabled/shimmer-bee" ]; then
    if [ "$ufw" = "true" ]; then
        if [ "$proxyShimmerBeePort" != "$proxyIotaHornetPort" ] && [ "$proxyShimmerBeePort" != "$proxyHornetShimmerPort" ] && [ "$proxyShimmerBeePort" != "$proxyIotaBeePort" ] && [ "$proxyShimmerBeePort" != "$proxyGoshimmerPort" ] && [ "$proxyShimmerBeePort" != "$proxyWaspDashboardPort" ] && [ "$proxyShimmerBeePort" != "$proxyWaspApiPort" ]; then
            sudo ufw delete allow $proxyShimmerBeePort/tcp > /dev/null 2>&1
        fi
    fi
    sudo sed -i 's/^proxyShimmerBeeUrl=.*/proxyShimmerBeeUrl=""/' $swarmConfigs/proxy.cfg
    sudo rm -rf /etc/nginx/sites-enabled/shimmer-bee > /dev/null 2>&1
    sudo systemctl reload nginx
fi