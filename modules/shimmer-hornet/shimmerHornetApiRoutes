#!/bin/bash

# Unset VARS
unset shimmerHornetApiPublicRoutes

# /health
if [[ $shimmerHornetApiRoutes = */health* ]]; then
    shimmerHornetApiRoutesHealth=OFF
else
    shimmerHornetApiRoutesHealth=ON
    shimmerHornetApiPublicRoutes="/health"
fi

# /api/v2/info
if [[ $shimmerHornetApiRoutes = */api/v2/info* ]]; then
    shimmerHornetApiRoutesInfo=OFF
else
    shimmerHornetApiRoutesInfo=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/info")
fi

# /api/v2/tips
if [[ $shimmerHornetApiRoutes = */api/v2/tips* ]]; then
    shimmerHornetApiRoutesTips=OFF
else
    shimmerHornetApiRoutesTips=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/tips")
fi

# /api/v2/blocks
if [[ $shimmerHornetApiRoutes = */api/v2/blocks\** ]]; then
    shimmerHornetApiRoutesBlocks=OFF
else
    shimmerHornetApiRoutesBlocks=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/blocks*")
fi

#/api/v2/transactions
if [[ $shimmerHornetApiRoutes = */api/v2/transactions\** ]]; then
    shimmerHornetApiRoutesTransactions=OFF
else
    shimmerHornetApiRoutesTransactions=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/transactions*")
fi

#/api/v2/milestones
if [[ $shimmerHornetApiRoutes = */api/v2/milestones\** ]]; then
    shimmerHornetApiRoutesMilestones=OFF
else
    shimmerHornetApiRoutesMilestones=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/milestones*")
fi

#/api/v2/outputs
if [[ $shimmerHornetApiRoutes = */api/v2/outputs\** ]]; then
    shimmerHornetApiRoutesOutputs=OFF
else
    shimmerHornetApiRoutesOutputs=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/outputs*")
fi

#/api/v2/treasury
if [[ $shimmerHornetApiRoutes = */api/v2/treasury* ]]; then
    shimmerHornetApiRoutesTreasury=OFF
else
    shimmerHornetApiRoutesTreasury=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/treasury")
fi

#/api/v2/receipts
if [[ $shimmerHornetApiRoutes = */api/v2/receipts\** ]]; then
    shimmerHornetApiRoutesReceipts=OFF
else
    shimmerHornetApiRoutesReceipts=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/v2/receipts*")
fi

#/api/plugins/debug/v1/*
if [[ $shimmerHornetApiRoutes = */api/plugins/debug/v1/\** ]]; then
    shimmerHornetApiRoutesDebug=OFF
else
    shimmerHornetApiRoutesDebug=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/plugins/debug/v1/*")
fi

#/api/plugins/indexer/v1/*
if [[ $shimmerHornetApiRoutes = */api/plugins/indexer/v1/\** ]]; then
    shimmerHornetApiRoutesIndexer=OFF
else
    shimmerHornetApiRoutesIndexer=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/plugins/indexer/v1/*")
fi

# /api/plugins/mqtt/v1
if [[ $shimmerHornetApiRoutes = */api/plugins/mqtt/v1* ]]; then
    shimmerHornetApiRoutesMqtt=OFF
else
    shimmerHornetApiRoutesMqtt=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/plugins/mqtt/v1")
fi

#/api/plugins/participation/v2/events*
if [[ $shimmerHornetApiRoutes = */api/plugins/participation/v2/events\** ]]; then
    shimmerHornetApiRoutesParticipationEvents=OFF
else
    shimmerHornetApiRoutesParticipationEvents=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/plugins/participation/v2/events*")
fi

#/api/plugins/participation/v2/outputs*
if [[ $shimmerHornetApiRoutes = */api/plugins/participation/v2/outputs\** ]]; then
    shimmerHornetApiRoutesParticipationOutputs=OFF
else
    shimmerHornetApiRoutesParticipationOutputs=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/plugins/participation/v2/outputs*")
fi

#/api/plugins/participation/v2/addresses*
if [[ $shimmerHornetApiRoutes = */api/plugins/participation/v2/addresses\** ]]; then
    shimmerHornetApiRoutesParticipationAddresses=OFF
else
    shimmerHornetApiRoutesParticipationAddresses=ON
    shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes,/api/plugins/participation/v2/addresses*")
fi

######

shimmerHornetApiPublicRoutes=$(echo "$shimmerHornetApiPublicRoutes" | tr -s ',,' ',')
validateShimmerHornetApiPublicRoutes=$(echo "${shimmerHornetApiPublicRoutes: -1}")
if [ "$validateShimmerHornetApiPublicRoutes" = "," ]; then
    shimmerHornetApiPublicRoutes="${shimmerHornetApiPublicRoutes%?}"
fi

if [ "$shimmerHornetUpdateApiRoutes" = "true" ]; then
    sudo sed -i 's~^shimmerHornetApiPublicRoutes=.*~shimmerHornetApiPublicRoutes="'$shimmerHornetApiPublicRoutes'"~' $swarmConfigs/shimmer-hornet.cfg
fi
