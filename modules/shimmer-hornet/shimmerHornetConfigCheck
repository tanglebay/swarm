#!/bin/bash
if [ -f "$shimmerHornetHome/$shimmerHornetConfig.json" ]; then
    checkConfigFile=$(cat $shimmerHornetHome/$shimmerHornetConfig.json)
fi

# TMP
shimmerHornetNetworkName="$(jq '.protocol.targetNetworkName' $shimmerHornetHome/$shimmerHornetConfig.json)"
shimmerHornetNetworkName=$(echo $shimmerHornetNetworkName | tr -d '"')
shimmerHornetConfigPubkeyCheck="$(jq '.protocol.publicKeyRanges' $shimmerHornetHome/$shimmerHornetConfig.json | grep "a507d2a592a5f0424ed8530603c08acebe088ae26211e90b79bfec0970a2397f")"
shimmerHornetConfigPubkeyCheck=$(echo $shimmerHornetNetworkName | tr -d '"')
if [ -z "$checkConfigFile" ] || [ ! -f "$shimmerHornetHome/$shimmerHornetConfig.json" ] || [ "$shimmerHornetNetworkName" = "shimmer" ] || [ -z "$shimmerHornetConfigPubkeyCheck" ]; then
######
    if [ "$shimmerHornetNetwork" = "mainnet" ]; then
        if [ -f "$shimmerHornetHome/$shimmerHornetConfig.json" ]; then
            sudo chown hornet:hornet $shimmerHornetHome/$shimmerHornetConfig.json > /dev/null 2>&1
        fi
        sudo -u hornet wget -q -O $shimmerHornetHome/$shimmerHornetConfig.json https://raw.githubusercontent.com/iotaledger/hornet/develop/config_defaults.json
    fi
    if [ "$shimmerHornetNetwork" = "testnet" ]; then
        if [ -f "$shimmerHornetHome/$shimmerHornetConfig.json" ]; then
            sudo chown hornet:hornet $shimmerHornetHome/$shimmerHornetConfig.json > /dev/null 2>&1
        fi
        
        sudo -u hornet wget -q -O $shimmerHornetHome/$shimmerHornetConfig.json https://raw.githubusercontent.com/iotaledger/hornet/develop/config_testnet.json
    fi
fi

if [ -f "/tmp/shimmerHornetParsing" ]; then
    sudo rm -rf /tmp/shimmerHornetParsing > /dev/null 2>&1
fi

unset checkConfigFile shimmerHornetNetworkName shimmerHornetConfigPubkeyCheck